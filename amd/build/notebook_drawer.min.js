require.config({enforceDefine:!0,shim:{bootstrapTable:["jquery"],bootstrapTableLocale:["jquery","bootstrapTable"],bootstrapTableLocaleMobile:["jquery","bootstrapTable"]},paths:{bootstrapTable:M.cfg.wwwroot+"/local/notebook/amd/build/bootstrap-table.min",bootstrapTableLocale:M.cfg.wwwroot+"/local/notebook/amd/build/bootstrap-table-locale-all.min",bootstrapTableLocaleMobile:M.cfg.wwwroot+"/local/notebook/amd/build/bootstrap-table-mobile.min"}});define ("local_notebook/notebook_drawer",["jquery","core/custom_interaction_events","core/drawer","core/pubsub","core/notification","core/str","core/ajax","core/templates","bootstrapTable","bootstrapTableLocale","bootstrapTableLocaleMobile"],function(a,b,c,d,e,f,g,h){var i=this,j={JUMPTO:".notebookbutton [data-region=\"jumpto\"]",DRAWER:"[data-region=\"right-hand-notebook-drawer\"]",HEADER_CONTAINER:"[data-region=\"header-container\"]",BODY_CONTAINER:"[data-region=\"body-container\"]",BODY_LIST:"[data-region=\"view-overview\"]",CLOSE_BUTTON:"[data-action=\"closedrawer\"]",NOTE_TABLE:"#notebook-table",REFRESH_BUTTON:"button[name=\"refresh\"]",ADD_BUTTON_TO_CLONE:"#notebook-table-container .addnote",SAVE_BUTTON:"#savenote",CANCEL_BUTTON:"#cancel-add-edit",NOTE_FORM_ID:"noteform",VIEW_NOTE:"[data-region=\"body-container\"] #notebook-table .viewnote",BACK_TO_LIST:"[data-region=\"header-container\"] .backtolist",NOTE_VIEW:"[data-region=\"body-container\"] [data-region=\"view-note\"]",FOOTER_NOTE_VIEW:"[data-region=\"footer-container\"] [data-region=\"view-note\"]",HEADER_NOTE_VIEW:"[data-region=\"header-container\"] [data-region=\"view-note\"]",HEADER_NOTE_CREATED_DATE:"[data-region=\"header-container\"] .notecreateddate",HEADER_NOTE_LAST_MODIFIED_DATE:"[data-region=\"header-container\"] .notelastmodifieddate",NOTE_FORM_CONTAINER:"[data-region=\"body-container\"] #add-note-form-container",NOTE_LIST_CONTAINER:"[data-region=\"body-container\"] #list-note-container",NOTE_TABLE_CONTAINER:"[data-region=\"body-container\"] #notebook-table-container",NOTE_TABLE_ROW:"[data-region=\"body-container\"] #notebook-table tr",NOTE_FORM:"[data-region=\"body-container\"] #noteform",HEADER_NOTE_DELETE:"[data-region=\"header-container\"] .deletenote",HEADER_NOTE_EDIT:"[data-region=\"header-container\"] .editnote",FOOTER_NOTE_TAGS:"[data-region=\"footer-container\"] .notetags",MESSAGE_SUCCESS_CONTAINER:"#message-success-container",DIALOGUE_CONTAINER:"[data-region=\"right-hand-notebook-drawer\"] [data-region=\"confirm-dialogue-container\"]",CONFIRM_TEXT_MULTI:"[data-region=\"right-hand-notebook-drawer\"] [data-region=\"confirm-dialogue-container\"] .multiplenotes",CONFIRM_TEXT_SINGLE:"[data-region=\"right-hand-notebook-drawer\"] [data-region=\"confirm-dialogue-container\"] .singlenote",CONFIRM_DELETE_BUTTON_MULTI:"[data-region=\"confirm-dialogue-container\"] [data-action=\"confirm-delete-multiple\"]",CONFIRM_DELETE_BUTTON_SINGLE:"[data-region=\"confirm-dialogue-container\"] [data-action=\"confirm-delete-single\"]",CANCEL_DELETE_BUTTON_MULTI:"[data-region=\"confirm-dialogue-container\"] [data-action=\"cancel-delete-multiple\"]",CANCEL_DELETE_BUTTON_SINGLE:"[data-region=\"confirm-dialogue-container\"] [data-action=\"cancel-delete-single\"]",DELETE_NOTE_BUTTON:".deletenote",CHECKBOX_LIST_NOTE:"[name=\"btSelectItem\"]",CHECKBOX_ALL_NOTE:"[name=\"btSelectAll\"]",TABLE_DELETE_BUTTON:"#delete-selected-notes",NOTE_LIST_ACTIONS:"#note-list-actions",SELECTED_NOTE_COUNT:"#note-list-actions .selected-note-count",CLOSE_NOTE_LIST_ACTIONS:"#note-list-actions .close",TABLE_PAGINATION:"[data-region=\"right-hand-notebook-drawer\"] .fixed-table-pagination",SEEALL_CONTAINER:"[data-region=\"footer-container\"] [data-region=\"view-overview\"]"},k={SHOW:"notebook-drawer-show",HIDE:"notebook-drawer-hide",TOGGLE_VISIBILITY:"notebook-drawer-toggle"},l=function(a){if(!a.attr("data-shown")){a.attr("data-shown",!0)}var b=z(a);if(b.length){c.show(b);r()}},m=function(){var a=i.$table.bootstrapTable("getOptions").pageNumber;i.$table.bootstrapTable("destroy");r(a)},n=function(a){var b="";a.forEach(function(a){b+="<span class=\"badge badge-info text-truncate context-note\"><a title=\""+a.title+"\" href=\""+a.url+"\">"+a.title+"</a></span>"});return b},o=function(){var b=j.FOOTER_NOTE_VIEW+", "+j.HEADER_NOTE_CREATED_DATE+", "+j.HEADER_NOTE_LAST_MODIFIED_DATE+", "+j.NOTE_VIEW;a(b).addClass("blur-content")},p=function(){var b=j.FOOTER_NOTE_VIEW+", "+j.HEADER_NOTE_CREATED_DATE+", "+j.HEADER_NOTE_LAST_MODIFIED_DATE+", "+j.NOTE_VIEW;a(b).removeClass("blur-content")},q=function(b){var c=[];E();o();c=g.call([{methodname:"local_notebook_read_note",args:{noteid:b}},{methodname:"local_notebook_note_viewed",args:{id:b}}]);c[0].done(function(b){var d={subject:b.subject,summary:b.summary},e=1e3*b.created,f=new Date(e).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"}),g=new Date(e).toLocaleTimeString(document.documentElement.lang),i=1e3*b.lastmodified,k=new Date(i).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"}),l=new Date(i).toLocaleTimeString(document.documentElement.lang);h.render("local_notebook/note_content",d).then(function(d){a(j.NOTE_VIEW).html(d);a(j.HEADER_NOTE_CREATED_DATE).html(f+" "+g);a(j.HEADER_NOTE_LAST_MODIFIED_DATE).html(k+" "+l);a(j.HEADER_NOTE_DELETE).data("noteid",b.id);a(j.HEADER_NOTE_EDIT).data("noteid",b.id);a(j.FOOTER_NOTE_TAGS).html(n(b.tags));p();a(j.BACK_TO_LIST).data("noteid",b.id);a(j.BACK_TO_LIST).focus();c[1].done(function(){}).fail(Notification.exception)}).fail(Notification.exception)}).fail(Notification.exception)},r=function(b){var c=[];c=g.call([{methodname:"local_notebook_notes_list",args:{userid:i.userid,courseid:i.courseid,coursemoduleid:i.coursemoduleid}}]);f.get_strings([{key:"notetitle",component:"local_notebook"},{key:"notedate",component:"local_notebook"},{key:"displaynote",component:"local_notebook"},{key:"lastmodifieddate",component:"local_notebook"}]).then(function(d){var f=document.querySelector("#list-note-container"),g=f.offsetHeight,h=[];c[0].done(function(c){a.each(c,function(a,b){var c={text:b.subject,tags:b.tags};h.push({id:b.id,subjecttext:b.subject,subject:c,lastmodified:b.lastmodified})});this.$table.bootstrapTable({locale:document.documentElement.lang,paginationParts:["pageInfo","pageList"],paginationSuccessivelySize:2,paginationPagesBySide:1,data:h,height:g,pageNumber:b,columns:[[{field:"state",checkbox:!0},{field:"subjecttext",visible:!1},{field:"subject",title:d[0],sortable:!0,sortName:"subjecttext",formatter:function formatter(a){var b=a.tags.length,c="<span class='text-truncate subject'>"+a.text+"</span><br>",d=1===b?"wcn-1":"wcn-2";a.tags.forEach(function(a){c+="<span class=\"badge badge-info text-truncate context-note "+d+"\"><a title=\""+a.tooltip+"\" href=\""+a.url+"\">"+a.title+"</a></span>"});return c}},{field:"lastmodified",title:d[1],sortable:!0,formatter:function formatter(a){var b=new Date(1e3*a).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"});return b},width:110,titleTooltip:d[3]},{field:"operate",title:"",align:"center",width:35,formatter:function formatter(a,b){return["<a class=\"viewnote\" data-noteid=\""+b.id+"\" href=\"#\" title=\""+d[2]+"\">","<i class=\"fa fa-chevron-right\" aria-hidden=\"true\"></i>","</a>"].join("")}}]],onSearch:function onSearch(){t()},onPostBody:function onPostBody(){s();a(".card-views").each(function(){a(this).find(".card-view").slice(1,3).wrapAll("<div class=\"item-content\" />")})}})}).fail(e.exception)}).fail(Notification.exception)},s=function(){if(!a(j.NOTE_TABLE_CONTAINER).find(".fixed-table-container .addnote").length){var b=a(j.ADD_BUTTON_TO_CLONE).clone().removeClass("hidden");a(j.NOTE_TABLE_CONTAINER).find(".fixed-table-container").append(b);b.on("click",function(){a(j.DRAWER).removeClass("list").addClass("add");C();F("show");t()})}},t=function(){if(!a(j.NOTE_LIST_ACTIONS).hasClass("hidden")){a(j.CLOSE_NOTE_LIST_ACTIONS).trigger("click")}},u=function(b,c){a(j.DIALOGUE_CONTAINER).addClass("hidden");if(!c){return}if("multiple"===b){a(j.TABLE_DELETE_BUTTON).focus()}else{a(j.DELETE_NOTE_BUTTON).focus()}},v=function(b){a(j.DIALOGUE_CONTAINER).removeClass("hidden");if("multiple"===b){var c=j.CONFIRM_TEXT_MULTI+", "+j.CONFIRM_DELETE_BUTTON_MULTI+","+j.CANCEL_DELETE_BUTTON_MULTI,d=j.CONFIRM_TEXT_SINGLE+", "+j.CONFIRM_DELETE_BUTTON_SINGLE+","+j.CANCEL_DELETE_BUTTON_SINGLE;a(d).addClass("hidden");a(c).removeClass("hidden");var g=[];a(j.DRAWER+" "+j.CHECKBOX_LIST_NOTE+":checked").each(function(){g.push(a(this).val())});a(j.CONFIRM_DELETE_BUTTON_MULTI).data("noteid",g);a(j.CONFIRM_DELETE_BUTTON_MULTI).focus()}else{var e=j.CONFIRM_TEXT_MULTI+", "+j.CONFIRM_DELETE_BUTTON_MULTI+","+j.CANCEL_DELETE_BUTTON_MULTI,f=j.CONFIRM_TEXT_SINGLE+", "+j.CONFIRM_DELETE_BUTTON_SINGLE+","+j.CANCEL_DELETE_BUTTON_SINGLE;a(e).addClass("hidden");a(f).removeClass("hidden");a(j.CONFIRM_DELETE_BUTTON_SINGLE).data("noteid",a(j.HEADER_NOTE_DELETE).data("noteid"));a(j.CONFIRM_DELETE_BUTTON_SINGLE).focus()}},w=function(a){var b=z(a);if(b.length){c.hide(b)}},x=function(a){var b=z(a);if(b.length){return c.isVisible(b)}return!0},y=function(b){a(j.DRAWER).attr("data-origin",b)},z=function(b){b=a(b);return b.closest("[data-region=\"right-hand-notebook-drawer\"]")},A=function(){if("reset"==a(document.activeElement).data("action")){C()}else{var b={},c=!1,d="local_notebook_add_note",f=a(j.NOTE_FORM+" input[name=\"noteid\"]").val();if("0"!==f){c=!0;d="local_notebook_update_note";b.noteid=f}else{b.userid=i.userid;b.courseid=i.courseid;b.coursemoduleid=i.coursemoduleid}b.subject=a(j.NOTE_FORM+" input[name=\"subject\"]").val();b.note=a(j.NOTE_FORM).serialize();g.call([{methodname:d,args:b,done:function done(d){if(d){var f=b.noteid;if(!c){f=d;delete b.subject;delete b.note;delete b.noteid;g.call([{methodname:"local_notebook_get_form_subject",args:b,done:function done(b){if(b){a(j.NOTE_FORM+" input[name=\"subjectorigin\"]").val(b);C();H("notesaved");m()}},fail:e.exception}])}else{C();H("notesaved");m()}q(f)}},fail:e.exception}])}return!1},B=function(){var b=a(document.activeElement).data("action"),c=[],d="notedeleted";if("confirm-delete-multiple"===b){c=a(document.activeElement).data("noteid");d="notedeletedmultiple"}else{c.push(a(document.activeElement).data("noteid"))}g.call([{methodname:"local_notebook_delete_notes",args:{notes:c},done:function done(c){if(c){u("multiple",!1);if("confirm-delete-single"===b){F("hide");D(!1)}H(d);if("confirm-delete-multiple"===b){a(j.NOTE_LIST_ACTIONS).addClass("hidden");J("show")}a(j.DRAWER).removeClass("view").addClass("list");m()}},fail:e.exception}]);return!1},C=function(){a(j.NOTE_FORM+" input[name=\"subject\"]").val(a(j.NOTE_FORM+" input[name=\"subjectorigin\"]").val());a(j.NOTE_FORM+" textarea").val("");a(j.BODY_CONTAINER+" #id_noteeditable").html("");a(j.NOTE_FORM+" textarea").trigger("change");a(j.NOTE_FORM+" input[name=\"noteid\"]").val(0);a(j.MESSAGE_SUCCESS_CONTAINER).html("")},D=function(b){a(j.HEADER_NOTE_VIEW).addClass("hidden");a(j.HEADER_NOTE_VIEW).attr("aria-hidden",!0);a(j.FOOTER_NOTE_VIEW).addClass("hidden");a(j.FOOTER_NOTE_VIEW).attr("aria-hidden",!0);a(j.NOTE_VIEW).addClass("hidden");a(j.NOTE_VIEW).attr("aria-hidden",!0);a(j.BODY_LIST).removeClass("hidden");a(j.BODY_LIST).removeAttr("aria-hidden");if(!b){return}a(b).focus()},E=function(){a(j.DRAWER).removeClass("list add edit").addClass("view");a(j.HEADER_NOTE_VIEW).removeClass("hidden");a(j.HEADER_NOTE_VIEW).removeAttr("aria-hidden");a(j.FOOTER_NOTE_VIEW).removeClass("hidden");a(j.FOOTER_NOTE_VIEW).removeAttr("aria-hidden");a(j.NOTE_VIEW).removeClass("hidden");a(j.NOTE_VIEW).removeAttr("aria-hidden");a(j.BODY_LIST).addClass("hidden");a(j.BODY_LIST).attr("aria-hidden",!0);a(j.NOTE_TABLE_CONTAINER).addClass("hidden")},F=function(b){if("show"===b){a(j.NOTE_LIST_CONTAINER).removeClass("h-100");a(j.NOTE_TABLE_CONTAINER).addClass("hidden");a(j.NOTE_FORM_CONTAINER).removeClass("hidden")}else{a(j.NOTE_LIST_CONTAINER).addClass("h-100");a(j.NOTE_TABLE_CONTAINER).removeClass("hidden");a(j.NOTE_FORM_CONTAINER).addClass("hidden")}},G=function(b){g.call([{methodname:"local_notebook_read_note",args:{noteid:b},done:function done(c){if(c){a(j.DRAWER).removeClass("view").addClass("edit");a(j.BODY_CONTAINER+" #id_noteeditable").html(c.summary);a(j.NOTE_FORM+" textarea").val(a(j.NOTE_VIEW+" .textareaorigin").val());a(j.NOTE_FORM+" textarea").trigger("change");a(j.NOTE_FORM+" input[name=\"subject\"]").val(c.subject);a(j.NOTE_FORM+" input[name=\"noteid\"]").val(b);D(j.NOTE_FORM+" input[name=\"subject\"]");I();F("show");a(j.DRAWER).removeClass("view").addClass("edit")}},fail:e.exception}])},H=function(b){a(j.MESSAGE_SUCCESS_CONTAINER).html("");f.get_strings([{key:b,component:"local_notebook"},{key:"close",component:"core"}]).then(function(b){var c="<div class=\"alert alert-success alert-block fade in \" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\""+b[1]+"\">\xD7</button>"+b[0]+"</div>";a(j.MESSAGE_SUCCESS_CONTAINER).html(c);a(j.MESSAGE_SUCCESS_CONTAINER+" .alert button").focus();setTimeout(function(){a(j.MESSAGE_SUCCESS_CONTAINER+" .alert").fadeOut()},1e4)})},I=function(){var b=a(j.BODY_CONTAINER+" #id_noteeditable").html(),c=!1,d=a(j.NOTE_FORM+" input[name=\"noteid\"]").val(),e=!1;if("0"!==d){var f=a(j.NOTE_FORM+" input[type=\"text\"]").val(),g=a(j.DRAWER+" .titlenote").html(),h=a(j.DRAWER+" .summarynote").html();if(0===f.localeCompare(g)&&0===b.localeCompare(h)){e=!0}}if(0===b.replace(/<(.|\n)*?>/g,"").trim().length&&!b.includes("<img")){c=!0}if(""==a(j.NOTE_FORM+" input[type=\"text\"]").val()||c||e){a(j.NOTE_FORM+" "+j.SAVE_BUTTON).prop("disabled",!0)}else{a(j.NOTE_FORM+" "+j.SAVE_BUTTON).prop("disabled",!1)}},J=function(b){if("hide"===b){a(j.TABLE_PAGINATION).addClass("invisible");a(j.SEEALL_CONTAINER).addClass("invisible")}else{a(j.TABLE_PAGINATION).removeClass("invisible");a(j.SEEALL_CONTAINER).removeClass("invisible")}},K=function(){var b=a(j.DRAWER+" "+j.CHECKBOX_LIST_NOTE+":checked").length;if(b){var c=b+" "+a(j.SELECTED_NOTE_COUNT).attr("data-arialabel");a(j.MESSAGE_SUCCESS_CONTAINER).empty();a(j.SELECTED_NOTE_COUNT).text(b);a(j.SELECTED_NOTE_COUNT).attr("aria-label",c);J("hide");a(j.NOTE_LIST_ACTIONS).removeClass("hidden")}else{J("show");a(j.NOTE_LIST_ACTIONS).addClass("hidden")}},L=function(e,f,g,h){i.userid=f;i.courseid=g;i.coursemoduleid=h;i.$table=a(j.NOTE_TABLE);a(j.DRAWER).on("click",j.REFRESH_BUTTON,function(){m()});b.define(e,[b.events.activate]);d.subscribe(k.SHOW,function(){l(e)});d.subscribe(k.HIDE,function(){w(e)});d.subscribe(k.TOGGLE_VISIBILITY,function(b){if(x(e)){w(e);a(j.JUMPTO).attr("tabindex",-1);Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.init({formid:j.NOTE_FORM_ID})});Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})}else{l(e);y(b);a(j.JUMPTO).attr("tabindex",0)}});a(j.JUMPTO).on("focus",function(){var b=e.find(j.CLOSE_BUTTON);if(b.length){b.focus()}else{a(j.HEADER_CONTAINER).find(j.ROUTES_BACK).focus()}});a(j.DRAWER).focus(function(){var b=a(this).attr("data-origin");if(b){a("#"+b).focus()}});var n=e.find(j.CLOSE_BUTTON);n.on(b.events.activate,function(b,c){c.originalEvent.preventDefault();var e=a(j.DRAWER).attr("data-origin");if(e){a("#"+e).focus()}d.publish(k.TOGGLE_VISIBILITY)});a(j.DRAWER).on("click",j.BACK_TO_LIST,function(){F("hide");D(j.VIEW_NOTE+"[data-noteid=\""+a(this).data("noteid")+"\"]");a(j.DRAWER).removeClass("view").addClass("list")});a(j.DRAWER).on("click",j.NOTE_TABLE_ROW+" td:not(:first-child)",function(b){if(!a(b.target).hasClass("context-note")&&!a(b.target).parent().hasClass("context-note")){var c=a(this).closest("tr").find(".viewnote").data("noteid");q(c);t()}});a(j.DRAWER).on("click",j.NOTE_TABLE_ROW+" td:first-child",function(b){if(a(this).find(".card-views").length){if(!a(b.target).is("label, input")&&!a(b.target).hasClass("context-note")&&!a(b.target).parent().hasClass("context-note")){var c=a(this).closest("tr").find(".viewnote").data("noteid");q(c);t()}}else{a(this).find("input[type=\"checkbox\"]").trigger("click")}});a(j.DRAWER).on("click",j.HEADER_NOTE_EDIT,function(){G(a(this).data("noteid"))});a(j.DRAWER).on("click",j.CANCEL_BUTTON,function(b){b.preventDefault();if(a(j.DRAWER).hasClass("edit")){var c=a(j.HEADER_NOTE_EDIT).data("noteid");q(c)}else{F("hide");a(j.DRAWER).removeClass("add").addClass("list")}});a(j.DRAWER).on("click",j.CANCEL_DELETE_BUTTON_SINGLE,function(){u("single",!0)});a(j.DRAWER).on("click",j.CANCEL_DELETE_BUTTON_MULTI,function(){u("multiple",!0)});a(j.DRAWER).on("click",j.DELETE_NOTE_BUTTON,function(){var b="multiple";if(a(this).data("noteid")){b="single"}v(b)});a(j.DRAWER).on("click",j.CONFIRM_DELETE_BUTTON_SINGLE+" , "+j.CONFIRM_DELETE_BUTTON_MULTI,B);var o=c.getDrawerRoot(a("[data-region=\"message-drawer\"]")),p=a("[id^=\"message-drawer-toggle-\"]");p.on("click keydown keypress",function(){var a=event.keyCode?event.keyCode:event.which;if("13"==a||"32"==a||"click"==event.type){if(c.isVisible(o)&&x(e)){w(e)}}});a(j.BODY_CONTAINER).on("submit","form",A);I();a(j.BODY_CONTAINER+" form input[type=\"text\"]").on("input",I);a(j.BODY_CONTAINER+" form textarea").on("change",I);a(j.DRAWER).on("change",j.CHECKBOX_LIST_NOTE+", "+j.CHECKBOX_ALL_NOTE,K);a(j.DRAWER).on("click",j.CLOSE_NOTE_LIST_ACTIONS,function(){a(j.CHECKBOX_ALL_NOTE).prop("checked",!1).trigger("click");J("show")})};return{init:function init(b,c,d,e){b=a(b);L(b,c,d,e)}}});
//# sourceMappingURL=notebook_drawer.min.js.map
