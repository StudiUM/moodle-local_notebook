require.config({enforceDefine:!0,shim:{bootstrapTable:["jquery"],bootstrapTableLocale:["jquery","bootstrapTable"],bootstrapTableLocaleMobile:["jquery","bootstrapTable"]},paths:{bootstrapTable:"/local/notebook/amd/build/bootstrap-table.min",bootstrapTableLocale:"/local/notebook/amd/build/bootstrap-table-locale-all.min",bootstrapTableLocaleMobile:"/local/notebook/amd/build/bootstrap-table-mobile.min"}});define ("local_notebook/notebook_drawer",["jquery","core/custom_interaction_events","core/drawer","core/pubsub","core/notification","core/str","core/ajax","bootstrapTable","bootstrapTableLocale","bootstrapTableLocaleMobile"],function(a,b,c,d,e,f,g){var h=this,i={JUMPTO:".notebookbutton [data-region=\"jumpto\"]",DRAWER:"[data-region=\"right-hand-notebook-drawer\"]",HEADER_CONTAINER:"[data-region=\"header-container\"]",BODY_CONTAINER:"[data-region=\"body-container\"]",CLOSE_BUTTON:"[data-action=\"closedrawer\"]",NOTE_TABLE:"#notebook-table",REFRESH_BUTTON:"button[name=\"refresh\"]",SAVE_BUTTON:"#savenote",RESET_BUTTON:"#resetnote",NOTE_FORM_ID:"noteform",NOTE_FORM:"[data-region=\"body-container\"] #noteform",MESSAGE_SUCCESS_CONTAINER:"[data-region=\"body-container\"] #fgroup_id_buttonar .col-form-label .form-label-addon"},j={SHOW:"notebook-drawer-show",HIDE:"notebook-drawer-hide",TOGGLE_VISIBILITY:"notebook-drawer-toggle"},k=function(a){if(!a.attr("data-shown")){a.attr("data-shown",!0)}var b=r(a);if(b.length){c.show(b);n()}},l=function(){this.$table.bootstrapTable("destroy");n()},m=function(){var b=a(i.BODY_CONTAINER).outerHeight(!0),c=a(i.BODY_CONTAINER+" #list-note-container").outerHeight(!0),d=a(i.BODY_CONTAINER+" #fitem_id_subject").outerHeight(!0),e=a(i.BODY_CONTAINER+" [data-region='footer']").outerHeight(!0),f=a(i.BODY_CONTAINER+" [role='toolbar']").outerHeight(!0),g=b-c-d-e-f-40;if(100>g){g=100}a(i.BODY_CONTAINER+" #id_noteeditable").css({"min-height":g+"px",height:g+"px"})},n=function(){var b=[];b=g.call([{methodname:"local_notebook_notes_list",args:{userid:this.userid,courseid:this.courseid,coursemoduleid:this.coursemoduleid}}]);f.get_strings([{key:"notetitle",component:"local_notebook"},{key:"notecontext",component:"local_notebook"},{key:"notedate",component:"local_notebook"},{key:"displaynote",component:"local_notebook"}]).then(function(c){var d=document.querySelector("[data-region=\"right-hand-notebook-drawer\"]"),f=d.offsetHeight,g=460;if(800>f){g=300}else if(600>f){g=250}var h=[];b[0].done(function(b){a.each(b,function(a,b){var c={text:b.subject,tags:b.tags};h.push({id:b.id,subject:c,contextname:b.contextname,created:b.created})});this.$table.bootstrapTable({locale:document.documentElement.lang,paginationParts:["pageInfo","pageList"],paginationSuccessivelySize:2,paginationPagesBySide:1,data:h,height:g,columns:[[{field:"state",checkbox:!0},{field:"subject",title:c[0],sortable:!0,width:300,formatter:function(a){var b=a.tags.length,c="<span class='text-truncate subject'>"+a.text+"</span><br>",d=1===b?"wcn-1":"wcn-2";a.tags.forEach(function(a){c+="<span class=\"badge badge-info text-truncate context-note "+d+"\"><a title=\""+a.title+"\" href=\""+a.url+"\">"+a.title+"</a></span>"});return c}},{field:"contextname",title:c[1],sortable:!0},{field:"created",title:c[2],sortable:!0,formatter:function(a){var b=new Date(1e3*a).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"});return b},width:110},{field:"operate",title:"",align:"center",formatter:function(){return["<a class=\"edit\" title=\""+c[3]+"\">","<i class=\"fa fa-chevron-right\"></i>","</a>"].join("")}}]],onPostBody:function onPostBody(){m()}})}).fail(e.exception)}).fail(Notification.exception)},o=function(a){var b=r(a);if(b.length){c.hide(b)}},p=function(a){var b=r(a);if(b.length){return c.isVisible(b)}return!0},q=function(b){a(i.DRAWER).attr("data-origin",b)},r=function(b){b=a(b);return b.closest("[data-region=\"right-hand-notebook-drawer\"]")},s=function(){if("reset"==a(document.activeElement).data("action")){t()}else{var b={userid:h.userid,courseid:h.courseid,coursemoduleid:h.coursemoduleid,subject:a(i.NOTE_FORM+" input[name=\"subject\"]").val(),note:a(i.NOTE_FORM).serialize()};g.call([{methodname:"local_notebook_add_note",args:b,done:function done(a){if(!a.error){u();l()}},fail:e.exception}])}return!1},t=function(){a(i.NOTE_FORM+" input[name=\"subject\"]").val(a(i.NOTE_FORM+" input[name=\"subjectorigin\"]").val());a(i.NOTE_FORM+" textarea").val("");a(i.BODY_CONTAINER+" #id_noteeditable").html("");a(i.NOTE_FORM+" textarea").trigger("change");a(i.MESSAGE_SUCCESS_CONTAINER).html("")},u=function(){a(i.MESSAGE_SUCCESS_CONTAINER).html("");f.get_strings([{key:"notesaved",component:"local_notebook"},{key:"close",component:"core"}]).then(function(b){var c="<div class=\"alert alert-success alert-block fade in \" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\""+b[1]+"\">\xD7</button>"+b[0]+"</div>";a(i.MESSAGE_SUCCESS_CONTAINER).html(c)})},v=function(){var b=a(i.NOTE_FORM+" textarea").val(),c=!1;if(0===b.replace(/<(.|\n)*?>/g,"").trim().length&&!b.includes("<img")){c=!0}if(""==a(i.NOTE_FORM+" input[type=\"text\"]").val()||c){a(i.NOTE_FORM+" "+i.SAVE_BUTTON).prop("disabled",!0)}else{a(i.NOTE_FORM+" "+i.SAVE_BUTTON).prop("disabled",!1)}},w=function(e,f,g,h){this.userid=f;this.courseid=g;this.coursemoduleid=h;this.$table=a(i.NOTE_TABLE);a(i.DRAWER).on("click",i.REFRESH_BUTTON,function(){l()});b.define(e,[b.events.activate]);d.subscribe(j.SHOW,function(){k(e)});d.subscribe(j.HIDE,function(){o(e)});d.subscribe(j.TOGGLE_VISIBILITY,function(b){if(p(e)){o(e);a(i.JUMPTO).attr("tabindex",-1);Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.init({formid:i.NOTE_FORM_ID})});Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})}else{k(e);q(b);a(i.JUMPTO).attr("tabindex",0)}});a(i.JUMPTO).on("focus",function(){var b=e.find(i.CLOSE_BUTTON);if(b.length){b.focus()}else{a(i.HEADER_CONTAINER).find(i.ROUTES_BACK).focus()}});a(i.DRAWER).focus(function(){var b=a(this).attr("data-origin");if(b){a("#"+b).focus()}});var m=e.find(i.CLOSE_BUTTON);m.on(b.events.activate,function(b,c){c.originalEvent.preventDefault();var e=a(i.DRAWER).attr("data-origin");if(e){a("#"+e).focus()}d.publish(j.TOGGLE_VISIBILITY)});var n=c.getDrawerRoot(a("[data-region=\"message-drawer\"]")),r=a("[id^=\"message-drawer-toggle-\"]");r.on("click keydown keypress",function(){var a=event.keyCode?event.keyCode:event.which;if("13"==a||"32"==a||"click"==event.type){if(c.isVisible(n)&&p(e)){o(e)}}});a(i.BODY_CONTAINER).on("submit","form",s);v();a(i.BODY_CONTAINER+" form input[type=\"text\"]").on("input",v);a(i.BODY_CONTAINER+" form textarea").on("change",v)};return{init:function init(b,c,d,e){b=a(b);w(b,c,d,e)}}});
//# sourceMappingURL=notebook_drawer.min.js.map
