/**
 * Controls the notebook drawer.
 *
 * @module     local_notebook/notebook_drawer
 * @copyright  2022 Université de Montréal
 * @author     Issam Taboubi <issam.taboubi@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
require.config({enforceDefine:!0,shim:{bootstrapTable:["jquery"],bootstrapTableLocale:["jquery","bootstrapTable"],bootstrapTableLocaleMobile:["jquery","bootstrapTable"]},paths:{bootstrapTable:M.cfg.wwwroot+"/local/notebook/amd/build/bootstrap-table.min",bootstrapTableLocale:M.cfg.wwwroot+"/local/notebook/amd/build/bootstrap-table-locale-all.min",bootstrapTableLocaleMobile:M.cfg.wwwroot+"/local/notebook/amd/build/bootstrap-table-mobile.min"}}),define("local_notebook/notebook_drawer",["jquery","core/custom_interaction_events","core/drawer","core/pubsub","core/notification","core/str","core/ajax","core/templates","bootstrapTable","bootstrapTableLocale","bootstrapTableLocaleMobile"],(function($,CustomEvents,Drawer,PubSub,notification,str,ajax,Templates){var SELECTORS={JUMPTO:'.notebookbutton [data-region="jumpto"]',DRAWER:'[data-region="right-hand-notebook-drawer"]',HEADER_CONTAINER:'[data-region="header-container"]',BODY_CONTAINER:'[data-region="body-container"]',BODY_LIST:'[data-region="view-overview"]',CLOSE_BUTTON:'[data-action="closedrawer"]',NOTE_TABLE:"#notebook-table",REFRESH_BUTTON:'button[name="refresh"]',ADD_BUTTON_TO_CLONE:"#notebook-table-container .addnote",SAVE_BUTTON:"#savenote",CANCEL_BUTTON:"#cancel-add-edit",NOTE_FORM_ID:"noteform",VIEW_NOTE:'[data-region="body-container"] #notebook-table .viewnote',BACK_TO_LIST:'[data-region="header-container"] .backtolist',NOTE_VIEW:'[data-region="body-container"] [data-region="view-note"]',FOOTER_NOTE_VIEW:'[data-region="footer-container"] [data-region="view-note"]',HEADER_NOTE_VIEW:'[data-region="header-container"] [data-region="view-note"]',HEADER_NOTE_CREATED_DATE:'[data-region="header-container"] .notecreateddate',HEADER_NOTE_LAST_MODIFIED_DATE:'[data-region="header-container"] .notelastmodifieddate',NOTE_FORM_CONTAINER:'[data-region="body-container"] #add-note-form-container',NOTE_LIST_CONTAINER:'[data-region="body-container"] #list-note-container',NOTE_TABLE_CONTAINER:'[data-region="body-container"] #notebook-table-container',NOTE_TABLE_ROW:'[data-region="body-container"] #notebook-table tr',NOTE_FORM:'[data-region="body-container"] #noteform',NOTE_SUMMARY:"#id_summary_editor",NOTE_ITEMID:'[name="summary_editor[itemid]"]',HEADER_NOTE_DELETE:'[data-region="header-container"] .deletenote',HEADER_NOTE_EDIT:'[data-region="header-container"] .editnote',FOOTER_NOTE_TAGS:'[data-region="footer-container"] .notetags',MESSAGE_SUCCESS_CONTAINER:"#message-success-container",DIALOGUE_CONTAINER:'[data-region="right-hand-notebook-drawer"] [data-region="confirm-dialogue-container"]',CONFIRM_TEXT_MULTI:'[data-region="right-hand-notebook-drawer"] [data-region="confirm-dialogue-container"] .multiplenotes',CONFIRM_TEXT_SINGLE:'[data-region="right-hand-notebook-drawer"] [data-region="confirm-dialogue-container"] .singlenote',CONFIRM_DELETE_BUTTON_MULTI:'[data-region="confirm-dialogue-container"] [data-action="confirm-delete-multiple"]',CONFIRM_DELETE_BUTTON_SINGLE:'[data-region="confirm-dialogue-container"] [data-action="confirm-delete-single"]',CANCEL_DELETE_BUTTON_MULTI:'[data-region="confirm-dialogue-container"] [data-action="cancel-delete-multiple"]',CANCEL_DELETE_BUTTON_SINGLE:'[data-region="confirm-dialogue-container"] [data-action="cancel-delete-single"]',DELETE_NOTE_BUTTON:".deletenote",CHECKBOX_LIST_NOTE:'[name="btSelectItem"]',CHECKBOX_ALL_NOTE:'[name="btSelectAll"]',TABLE_DELETE_BUTTON:"#delete-selected-notes",NOTE_LIST_ACTIONS:"#note-list-actions",SELECTED_NOTE_COUNT:"#note-list-actions .selected-note-count",CLOSE_NOTE_LIST_ACTIONS:"#note-list-actions .close",TABLE_PAGINATION:'[data-region="right-hand-notebook-drawer"] .fixed-table-pagination',SEEALL_CONTAINER:'[data-region="footer-container"] [data-region="view-overview"]'},Events_SHOW="notebook-drawer-show",Events_HIDE="notebook-drawer-hide",Events_TOGGLE_VISIBILITY="notebook-drawer-toggle",show=root=>{root.attr("data-shown")||root.attr("data-shown",!0);var drawerRoot=getDrawerRoot(root);drawerRoot.length&&(Drawer.show(drawerRoot),displayNotes())},refreshNotes=()=>{let previousPageNumber=this.$table.bootstrapTable("getOptions").pageNumber;this.$table.bootstrapTable("destroy"),displayNotes(previousPageNumber)},displayNote=noteid=>{var promises=[];displayNoteView(),$(SELECTORS.FOOTER_NOTE_VIEW+", "+SELECTORS.HEADER_NOTE_CREATED_DATE+", "+SELECTORS.HEADER_NOTE_LAST_MODIFIED_DATE+", "+SELECTORS.NOTE_VIEW).addClass("blur-content"),(promises=ajax.call([{methodname:"local_notebook_read_note",args:{noteid:noteid}},{methodname:"local_notebook_note_viewed",args:{id:noteid}}]))[0].done((function(result){let data={};data.subject=result.subject,data.summary=result.summary;let createdtimestamp=1e3*result.created,datecreation=new Date(createdtimestamp).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"}),timecreation=new Date(createdtimestamp).toLocaleTimeString(document.documentElement.lang),lastmodifiedtimestamp=1e3*result.lastmodified,lastmodifieddate=new Date(lastmodifiedtimestamp).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"}),lastmodifiedtime=new Date(lastmodifiedtimestamp).toLocaleTimeString(document.documentElement.lang);Templates.render("local_notebook/note_content",data).then((function(html){var tags,tagshtml;$(SELECTORS.NOTE_VIEW).html(html),$(SELECTORS.HEADER_NOTE_CREATED_DATE).html(datecreation+" "+timecreation),$(SELECTORS.HEADER_NOTE_LAST_MODIFIED_DATE).html(lastmodifieddate+" "+lastmodifiedtime),$(SELECTORS.HEADER_NOTE_DELETE).data("noteid",result.id),$(SELECTORS.HEADER_NOTE_EDIT).data("noteid",result.id),$(SELECTORS.FOOTER_NOTE_TAGS).html((tags=result.tags,tagshtml="",tags.forEach((function(item){let badge="badge-info";"#"===item.url?(badge="badge-secondary",tagshtml+='<span class="badge '+badge+' text-truncate context-note">'+item.title+"</span>"):tagshtml+='<span class="badge '+badge+' text-truncate context-note"><a title="'+item.title+'" href="'+item.url+'">'+item.title+"</a></span>"})),tagshtml)),$(SELECTORS.FOOTER_NOTE_VIEW+", "+SELECTORS.HEADER_NOTE_CREATED_DATE+", "+SELECTORS.HEADER_NOTE_LAST_MODIFIED_DATE+", "+SELECTORS.NOTE_VIEW).removeClass("blur-content"),$(SELECTORS.BACK_TO_LIST).data("noteid",result.id),$(SELECTORS.BACK_TO_LIST).focus(),promises[1].done((function(){})).fail(Notification.exception)})).fail(Notification.exception)})).fail(Notification.exception)},displayNotes=pageNumber=>{var promises=[];promises=ajax.call([{methodname:"local_notebook_notes_list",args:{userid:this.userid,courseid:this.courseid,coursemoduleid:this.coursemoduleid}}]);str.get_strings([{key:"notetitle",component:"local_notebook"},{key:"notedate",component:"local_notebook"},{key:"displaynote",component:"local_notebook"},{key:"lastmodifieddate",component:"local_notebook"}]).then((function(langStrings){let tableheight=document.querySelector("#list-note-container").offsetHeight,data=[];promises[0].done((function(result){$.each(result,(function(index,value){let subject={};subject.text=value.subject,subject.tags=value.tags,data.push({id:value.id,subjecttext:value.subject,subject:subject,lastmodified:value.lastmodified})})),this.$table.bootstrapTable({locale:document.documentElement.lang,paginationParts:["pageInfo","pageList"],paginationSuccessivelySize:2,paginationPagesBySide:1,data:data,height:tableheight,pageNumber:pageNumber,columns:[[{field:"state",checkbox:!0},{field:"subjecttext",visible:!1},{field:"subject",title:langStrings[0],sortable:!0,sortName:"subjecttext",formatter:function(value){let nbtags=value.tags.length;var td="<span class='text-truncate subject'>"+value.text+"</span><br>",nbclass=1===nbtags?"wcn-1":"wcn-2";return value.tags.forEach((function(item){let badge="badge-info";"#"===item.url?(badge="badge-secondary",td+='<span class="badge '+badge+" text-truncate context-note "+nbclass+'" title="'+item.tooltip+'">'+item.title+"</span>"):td+='<span class="badge '+badge+" text-truncate context-note "+nbclass+'"><a title="'+item.tooltip+'" href="'+item.url+'">'+item.title+"</a></span>"})),td}},{field:"lastmodified",title:langStrings[1],sortable:!0,formatter:function(value){return new Date(1e3*value).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"})},width:110,titleTooltip:langStrings[3]},{field:"operate",title:"",align:"center",width:35,formatter:function(value,row){return['<a class="viewnote" data-noteid="'+row.id+'" href="#" title="'+langStrings[2]+'">','<i class="fa fa-chevron-right" aria-hidden="true"></i>',"</a>"].join("")}}]],onSearch:function(){closeNoteListActions()},onPostBody:function(){displayAddNoteButton(),$(".card-views").each((function(){$(this).find(".card-view").slice(1,3).wrapAll('<div class="item-content" />')}))}})})).fail(notification.exception)})).fail(Notification.exception)},displayAddNoteButton=()=>{if(!$(SELECTORS.NOTE_TABLE_CONTAINER).find(".fixed-table-container .addnote").length){let addnotebtn=$(SELECTORS.ADD_BUTTON_TO_CLONE).clone().removeClass("hidden");$(SELECTORS.NOTE_TABLE_CONTAINER).find(".fixed-table-container").append(addnotebtn),addnotebtn.on("click",(function(){$(SELECTORS.DRAWER).removeClass("list").addClass("add"),resetNoteForm(),toggleNoteForm("show"),closeNoteListActions()}))}},closeNoteListActions=()=>{$(SELECTORS.NOTE_LIST_ACTIONS).hasClass("hidden")||$(SELECTORS.CLOSE_NOTE_LIST_ACTIONS).trigger("click")},closeConfirmDialogue=(action,focus)=>{$(SELECTORS.DIALOGUE_CONTAINER).addClass("hidden"),focus&&("multiple"===action?$(SELECTORS.TABLE_DELETE_BUTTON).focus():$(SELECTORS.DELETE_NOTE_BUTTON).focus())},showConfirmDialogue=action=>{if($(SELECTORS.DIALOGUE_CONTAINER).removeClass("hidden"),"multiple"===action){let toshow=SELECTORS.CONFIRM_TEXT_MULTI+", "+SELECTORS.CONFIRM_DELETE_BUTTON_MULTI+","+SELECTORS.CANCEL_DELETE_BUTTON_MULTI;$(SELECTORS.CONFIRM_TEXT_SINGLE+", "+SELECTORS.CONFIRM_DELETE_BUTTON_SINGLE+","+SELECTORS.CANCEL_DELETE_BUTTON_SINGLE).addClass("hidden"),$(toshow).removeClass("hidden");let list=[];$(SELECTORS.DRAWER+" "+SELECTORS.CHECKBOX_LIST_NOTE+":checked").each((function(){list.push($(this).val())})),$(SELECTORS.CONFIRM_DELETE_BUTTON_MULTI).data("noteid",list),$(SELECTORS.CONFIRM_DELETE_BUTTON_MULTI).focus()}else{let toshow=SELECTORS.CONFIRM_TEXT_SINGLE+", "+SELECTORS.CONFIRM_DELETE_BUTTON_SINGLE+","+SELECTORS.CANCEL_DELETE_BUTTON_SINGLE;$(SELECTORS.CONFIRM_TEXT_MULTI+", "+SELECTORS.CONFIRM_DELETE_BUTTON_MULTI+","+SELECTORS.CANCEL_DELETE_BUTTON_MULTI).addClass("hidden"),$(toshow).removeClass("hidden"),$(SELECTORS.CONFIRM_DELETE_BUTTON_SINGLE).data("noteid",$(SELECTORS.HEADER_NOTE_DELETE).data("noteid")),$(SELECTORS.CONFIRM_DELETE_BUTTON_SINGLE).focus()}},hide=root=>{var drawerRoot=getDrawerRoot(root);drawerRoot.length&&Drawer.hide(drawerRoot)},isVisible=root=>{var drawerRoot=getDrawerRoot(root);return!drawerRoot.length||Drawer.isVisible(drawerRoot)},getDrawerRoot=contentRoot=>(contentRoot=$(contentRoot)).closest('[data-region="right-hand-notebook-drawer"]'),submitFormAjax=()=>{if("reset"==$(document.activeElement).data("action"))resetNoteForm();else{let args={},update=!1,service="local_notebook_add_note",noteid=$(SELECTORS.NOTE_FORM+' input[name="noteid"]').val();"0"!==noteid?(update=!0,service="local_notebook_update_note",args.noteid=noteid):(args.userid=this.userid,args.courseid=this.courseid,args.coursemoduleid=this.coursemoduleid),args.subject=$(SELECTORS.NOTE_FORM+' input[name="subject"]').val(),args.note=$(SELECTORS.NOTE_SUMMARY).val(),args.itemid=$(SELECTORS.NOTE_ITEMID).val(),ajax.call([{methodname:service,args:args,done:function(result){if(result){var noteid=args.noteid;update?(resetNoteForm(),displayMessageSuccess("notesaved"),refreshNotes()):(noteid=result,delete args.subject,delete args.note,delete args.noteid,delete args.itemid,ajax.call([{methodname:"local_notebook_get_form_subject",args:args,done:function(subject){subject&&($(SELECTORS.NOTE_FORM+' input[name="subjectorigin"]').val(subject),resetNoteForm(),displayMessageSuccess("notesaved"),refreshNotes())},fail:notification.exception}])),displayNote(noteid)}},fail:notification.exception}])}return!1},submitDeleteAjax=()=>{let action=$(document.activeElement).data("action"),notesids=[],keymessage="notedeleted";return"confirm-delete-multiple"===action?(notesids=$(document.activeElement).data("noteid"),keymessage="notedeletedmultiple"):notesids.push($(document.activeElement).data("noteid")),ajax.call([{methodname:"local_notebook_delete_notes",args:{notes:notesids},done:function(result){result&&(closeConfirmDialogue("multiple",!1),"confirm-delete-single"===action&&(toggleNoteForm("hide"),hideNoteView(!1)),displayMessageSuccess(keymessage),"confirm-delete-multiple"===action&&($(SELECTORS.NOTE_LIST_ACTIONS).addClass("hidden"),toggleNoteListFooter("show")),$(SELECTORS.DRAWER).removeClass("view").addClass("list"),refreshNotes())},fail:notification.exception}]),!1},resetNoteForm=()=>{$(SELECTORS.NOTE_FORM+' input[name="subject"]').val($(SELECTORS.NOTE_FORM+' input[name="subjectorigin"]').val()),$(SELECTORS.NOTE_FORM+" textarea").val(""),$(SELECTORS.BODY_CONTAINER+" #id_summary_editoreditable").html(""),$(SELECTORS.NOTE_FORM+" textarea").trigger("change"),$(SELECTORS.NOTE_FORM+' input[name="noteid"]').val(0),$(SELECTORS.MESSAGE_SUCCESS_CONTAINER).html("")},hideNoteView=focus=>{$(SELECTORS.HEADER_NOTE_VIEW).addClass("hidden"),$(SELECTORS.HEADER_NOTE_VIEW).attr("aria-hidden",!0),$(SELECTORS.FOOTER_NOTE_VIEW).addClass("hidden"),$(SELECTORS.FOOTER_NOTE_VIEW).attr("aria-hidden",!0),$(SELECTORS.NOTE_VIEW).addClass("hidden"),$(SELECTORS.NOTE_VIEW).attr("aria-hidden",!0),$(SELECTORS.BODY_LIST).removeClass("hidden"),$(SELECTORS.BODY_LIST).removeAttr("aria-hidden"),focus&&$(focus).focus()},displayNoteView=()=>{$(SELECTORS.DRAWER).removeClass("list add edit").addClass("view"),$(SELECTORS.HEADER_NOTE_VIEW).removeClass("hidden"),$(SELECTORS.HEADER_NOTE_VIEW).removeAttr("aria-hidden"),$(SELECTORS.FOOTER_NOTE_VIEW).removeClass("hidden"),$(SELECTORS.FOOTER_NOTE_VIEW).removeAttr("aria-hidden"),$(SELECTORS.NOTE_VIEW).removeClass("hidden"),$(SELECTORS.NOTE_VIEW).removeAttr("aria-hidden"),$(SELECTORS.BODY_LIST).addClass("hidden"),$(SELECTORS.BODY_LIST).attr("aria-hidden",!0),$(SELECTORS.NOTE_TABLE_CONTAINER).addClass("hidden")},toggleNoteForm=action=>{"show"===action?($(SELECTORS.NOTE_LIST_CONTAINER).removeClass("h-100"),$(SELECTORS.NOTE_TABLE_CONTAINER).addClass("hidden"),$(SELECTORS.NOTE_FORM_CONTAINER).removeClass("hidden")):($(SELECTORS.NOTE_LIST_CONTAINER).addClass("h-100"),$(SELECTORS.NOTE_TABLE_CONTAINER).removeClass("hidden"),$(SELECTORS.NOTE_FORM_CONTAINER).addClass("hidden"))},displayMessageSuccess=key=>{$(SELECTORS.MESSAGE_SUCCESS_CONTAINER).html("");var stringkeys=[{key:key,component:"local_notebook"},{key:"close",component:"core"}];str.get_strings(stringkeys).then((function(langStrings){let messageHtml='<div class="alert alert-success alert-block fade in " role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="'+langStrings[1]+'">×</button>'+langStrings[0]+"</div>";$(SELECTORS.MESSAGE_SUCCESS_CONTAINER).html(messageHtml),$(SELECTORS.MESSAGE_SUCCESS_CONTAINER+" .alert button").focus(),setTimeout((function(){$(SELECTORS.MESSAGE_SUCCESS_CONTAINER+" .alert").fadeOut()}),1e4)}))},toggleSaveButton=()=>{let editorcontent=$(SELECTORS.BODY_CONTAINER+" #id_summary_editoreditable").html(),emptyeditor=!1,samecontent=!1;if("0"!==$(SELECTORS.NOTE_FORM+' input[name="noteid"]').val()){let subjectform=$(SELECTORS.NOTE_FORM+' input[type="text"]').val(),subjectorigin=$(SELECTORS.DRAWER+" .titlenote").html(),summaryorigin=$(SELECTORS.DRAWER+" .summarynote").html();0===subjectform.localeCompare(subjectorigin)&&0===editorcontent.localeCompare(summaryorigin)&&(samecontent=!0)}void 0===editorcontent||0!==editorcontent.replace(/<(.|\n)*?>/g,"").trim().length||editorcontent.includes("<img")||(emptyeditor=!0),""==$(SELECTORS.NOTE_FORM+' input[type="text"]').val()||emptyeditor||samecontent?$(SELECTORS.NOTE_FORM+" "+SELECTORS.SAVE_BUTTON).prop("disabled",!0):$(SELECTORS.NOTE_FORM+" "+SELECTORS.SAVE_BUTTON).prop("disabled",!1)},toggleNoteListFooter=action=>{"hide"===action?($(SELECTORS.TABLE_PAGINATION).addClass("invisible"),$(SELECTORS.SEEALL_CONTAINER).addClass("invisible")):($(SELECTORS.TABLE_PAGINATION).removeClass("invisible"),$(SELECTORS.SEEALL_CONTAINER).removeClass("invisible"))},toggleNoteListActions=()=>{let selectednotecount=$(SELECTORS.DRAWER+" "+SELECTORS.CHECKBOX_LIST_NOTE+":checked").length;if(selectednotecount){let arialabel=selectednotecount+" "+$(SELECTORS.SELECTED_NOTE_COUNT).attr("data-arialabel");$(SELECTORS.MESSAGE_SUCCESS_CONTAINER).empty(),$(SELECTORS.SELECTED_NOTE_COUNT).text(selectednotecount),$(SELECTORS.SELECTED_NOTE_COUNT).attr("aria-label",arialabel),toggleNoteListFooter("hide"),$(SELECTORS.NOTE_LIST_ACTIONS).removeClass("hidden")}else toggleNoteListFooter("show"),$(SELECTORS.NOTE_LIST_ACTIONS).addClass("hidden")},registerEventListeners=(root,userid,courseid,coursemoduleid)=>{this.userid=userid,this.courseid=courseid,this.coursemoduleid=coursemoduleid,this.$table=$(SELECTORS.NOTE_TABLE),$(SELECTORS.DRAWER).on("click",SELECTORS.REFRESH_BUTTON,(function(){refreshNotes()})),CustomEvents.define(root,[CustomEvents.events.activate]),PubSub.subscribe(Events_SHOW,(function(){show(root)})),PubSub.subscribe(Events_HIDE,(function(){hide(root)})),PubSub.subscribe(Events_TOGGLE_VISIBILITY,(function(buttonid){isVisible(root)?(hide(root),$(SELECTORS.JUMPTO).attr("tabindex",-1),Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.init({formid:SELECTORS.NOTE_FORM_ID})})),Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()}))):(show(root),(buttonid=>{$(SELECTORS.DRAWER).attr("data-origin",buttonid)})(buttonid),$(SELECTORS.JUMPTO).attr("tabindex",0))})),$(SELECTORS.JUMPTO).on("focus",(function(){var firstInput=root.find(SELECTORS.CLOSE_BUTTON);firstInput.length?firstInput.focus():$(SELECTORS.HEADER_CONTAINER).find(SELECTORS.ROUTES_BACK).focus()})),$(SELECTORS.DRAWER).focus((function(){var button=$(this).attr("data-origin");button&&$("#"+button).focus()})),root.find(SELECTORS.CLOSE_BUTTON).on(CustomEvents.events.activate,(function(e,data){data.originalEvent.preventDefault();var button=$(SELECTORS.DRAWER).attr("data-origin");button&&$("#"+button).focus(),PubSub.publish(Events_TOGGLE_VISIBILITY)})),$(SELECTORS.DRAWER).on("click",SELECTORS.BACK_TO_LIST,(function(){toggleNoteForm("hide"),hideNoteView(SELECTORS.VIEW_NOTE+'[data-noteid="'+$(this).data("noteid")+'"]'),$(SELECTORS.DRAWER).removeClass("view").addClass("list")})),$(SELECTORS.DRAWER).on("click",SELECTORS.NOTE_TABLE_ROW+" td:not(:first-child)",(function(e){if(!$(e.target).hasClass("context-note")&&!$(e.target).parent().hasClass("context-note")){let noteid=$(this).closest("tr").find(".viewnote").data("noteid");displayNote(noteid),closeNoteListActions()}})),$(SELECTORS.DRAWER).on("click",SELECTORS.NOTE_TABLE_ROW+" td:first-child",(function(e){if($(this).find(".card-views").length){if(!$(e.target).is("label, input")&&!$(e.target).hasClass("context-note")&&!$(e.target).parent().hasClass("context-note")){let noteid=$(this).closest("tr").find(".viewnote").data("noteid");displayNote(noteid),closeNoteListActions()}}else $(this).find('input[type="checkbox"]').trigger("click")})),$(SELECTORS.DRAWER).on("click",SELECTORS.HEADER_NOTE_EDIT,(function(){var noteid;noteid=$(this).data("noteid"),ajax.call([{methodname:"local_notebook_read_note",args:{noteid:noteid},done:function(result){result&&($(SELECTORS.DRAWER).removeClass("view").addClass("edit"),$(SELECTORS.BODY_CONTAINER+" #id_summary_editoreditable").html(result.summary),$(SELECTORS.NOTE_FORM+" textarea").val($(SELECTORS.NOTE_VIEW+" .textareaorigin").val()),$(SELECTORS.NOTE_FORM+" textarea").trigger("change"),$(SELECTORS.NOTE_FORM+' input[name="subject"]').val(result.subject),$(SELECTORS.NOTE_FORM+' input[name="noteid"]').val(noteid),hideNoteView(SELECTORS.NOTE_FORM+' input[name="subject"]'),toggleSaveButton(),toggleNoteForm("show"),$(SELECTORS.DRAWER).removeClass("view").addClass("edit"))},fail:notification.exception}])})),$(SELECTORS.DRAWER).on("click",SELECTORS.CANCEL_BUTTON,(function(e){if(e.preventDefault(),$(SELECTORS.DRAWER).hasClass("edit")){let noteid=$(SELECTORS.HEADER_NOTE_EDIT).data("noteid");displayNote(noteid)}else toggleNoteForm("hide"),$(SELECTORS.DRAWER).removeClass("add").addClass("list")})),$(SELECTORS.DRAWER).on("click",SELECTORS.CANCEL_DELETE_BUTTON_SINGLE,(function(){closeConfirmDialogue("single",!0)})),$(SELECTORS.DRAWER).on("click",SELECTORS.CANCEL_DELETE_BUTTON_MULTI,(function(){closeConfirmDialogue("multiple",!0)})),$(SELECTORS.DRAWER).on("click",SELECTORS.DELETE_NOTE_BUTTON,(function(){let action="multiple";$(this).data("noteid")&&(action="single"),showConfirmDialogue(action)})),$(SELECTORS.DRAWER).on("click",SELECTORS.CONFIRM_DELETE_BUTTON_SINGLE+" , "+SELECTORS.CONFIRM_DELETE_BUTTON_MULTI,submitDeleteAjax);var msdrawerRoot=Drawer.getDrawerRoot($('[data-region="message-drawer"]'));$('[id^="message-drawer-toggle-"]').on("click keydown keypress",(function(){var keycode=event.keyCode?event.keyCode:event.which;"13"!=keycode&&"32"!=keycode&&"click"!=event.type||Drawer.isVisible(msdrawerRoot)&&isVisible(root)&&hide(root)})),$(SELECTORS.BODY_CONTAINER).on("submit","form",submitFormAjax),toggleSaveButton(),$(SELECTORS.BODY_CONTAINER+' form input[type="text"]').on("input",toggleSaveButton),$(SELECTORS.BODY_CONTAINER+" form textarea").on("change",toggleSaveButton),$(SELECTORS.DRAWER).on("change",SELECTORS.CHECKBOX_LIST_NOTE+", "+SELECTORS.CHECKBOX_ALL_NOTE,toggleNoteListActions),$(SELECTORS.DRAWER).on("click",SELECTORS.CLOSE_NOTE_LIST_ACTIONS,(function(){$(SELECTORS.CHECKBOX_ALL_NOTE).prop("checked",!1).trigger("click"),toggleNoteListFooter("show")}))};return{init:(root,userid,courseid,coursemoduleid)=>{root=$(root),registerEventListeners(root,userid,courseid,coursemoduleid)}}}));

//# sourceMappingURL=notebook_drawer.min.js.map