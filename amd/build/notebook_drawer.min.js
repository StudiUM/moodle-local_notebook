require.config({enforceDefine:!0,shim:{bootstrapTable:["jquery"],bootstrapTableLocale:["jquery","bootstrapTable"],bootstrapTableLocaleMobile:["jquery","bootstrapTable"]},paths:{bootstrapTable:"/local/notebook/amd/build/bootstrap-table.min",bootstrapTableLocale:"/local/notebook/amd/build/bootstrap-table-locale-all.min",bootstrapTableLocaleMobile:"/local/notebook/amd/build/bootstrap-table-mobile.min"}});define ("local_notebook/notebook_drawer",["jquery","core/custom_interaction_events","core/drawer","core/pubsub","core/notification","core/str","core/ajax","core/templates","bootstrapTable","bootstrapTableLocale","bootstrapTableLocaleMobile"],function(a,b,c,d,e,f,g,h){var i=this,j={JUMPTO:".notebookbutton [data-region=\"jumpto\"]",DRAWER:"[data-region=\"right-hand-notebook-drawer\"]",HEADER_CONTAINER:"[data-region=\"header-container\"]",BODY_CONTAINER:"[data-region=\"body-container\"]",BODY_LIST:"[data-region=\"view-overview\"]",CLOSE_BUTTON:"[data-action=\"closedrawer\"]",NOTE_TABLE:"#notebook-table",REFRESH_BUTTON:"button[name=\"refresh\"]",SAVE_BUTTON:"#savenote",RESET_BUTTON:"#resetnote",NOTE_FORM_ID:"noteform",VIEW_NOTE:"[data-region=\"body-container\"] #notebook-table .viewnote",BACK_TO_LIST:"[data-region=\"header-container\"] .backtolist",NOTE_VIEW:"[data-region=\"body-container\"] [data-region=\"view-note\"]",FOOTER_NOTE_VIEW:"[data-region=\"footer-container\"] [data-region=\"view-note\"]",HEADER_NOTE_VIEW:"[data-region=\"header-container\"] [data-region=\"view-note\"]",HEADER_NOTE_DATE:"[data-region=\"header-container\"] .notedate",NOTE_FORM:"[data-region=\"body-container\"] #noteform",FOOTER_NOTE_DELETE:"[data-region=\"footer-container\"] .deletenote",FOOTER_NOTE_EDIT:"[data-region=\"footer-container\"] .editnote",FOOTER_NOTE_TAGS:"[data-region=\"footer-container\"] .notetags",MESSAGE_SUCCESS_CONTAINER:"[data-region=\"body-container\"] #fgroup_id_buttonar .col-form-label .form-label-addon"},k={SHOW:"notebook-drawer-show",HIDE:"notebook-drawer-hide",TOGGLE_VISIBILITY:"notebook-drawer-toggle"},l=function(a){if(!a.attr("data-shown")){a.attr("data-shown",!0)}var b=w(a);if(b.length){c.show(b);s()}},m=function(){this.$table.bootstrapTable("destroy");s()},n=function(a){var b="";a.forEach(function(a){b+="<span class=\"badge badge-info text-truncate context-note\"><a title=\""+a.title+"\" href=\""+a.url+"\">"+a.title+"</a></span>"});return b},o=function(){var b=j.FOOTER_NOTE_VIEW+", "+j.HEADER_NOTE_DATE+", "+j.NOTE_VIEW;a(b).addClass("blur-content")},p=function(){var b=j.FOOTER_NOTE_VIEW+", "+j.HEADER_NOTE_DATE+", "+j.NOTE_VIEW;a(b).removeClass("blur-content")},q=function(b){var c=[];A();o();c=g.call([{methodname:"local_notebook_read_note",args:{noteid:b}},{methodname:"local_notebook_note_viewed",args:{id:b}}]);c[0].done(function(b){var d={subject:b.subject,summary:b.summary},e=1e3*b.created,f=new Date(e).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"}),g=new Date(e).toLocaleTimeString(document.documentElement.lang);h.render("local_notebook/note_content",d).then(function(d){a(j.NOTE_VIEW).html(d);a(j.HEADER_NOTE_DATE).html(f+" "+g);a(j.FOOTER_NOTE_DELETE).data("noteid",b.id);a(j.FOOTER_NOTE_EDIT).data("noteid",b.id);a(j.FOOTER_NOTE_TAGS).html(n(b.tags));p();a(j.BACK_TO_LIST).data("noteid",b.id);a(j.BACK_TO_LIST).focus();c[1].done(function(){}).fail(Notification.exception)}).fail(Notification.exception)}).fail(Notification.exception)},r=function(){var b=a(j.BODY_CONTAINER).outerHeight(!0),c=a(j.BODY_CONTAINER+" #list-note-container").outerHeight(!0),d=a(j.BODY_CONTAINER+" #fitem_id_subject").outerHeight(!0),e=a(j.BODY_CONTAINER+" [data-region='footer']").outerHeight(!0),f=a(j.BODY_CONTAINER+" [role='toolbar']").outerHeight(!0),g=b-c-d-e-f-40;if(100>g){g=100}a(j.BODY_CONTAINER+" #id_noteeditable").css({"min-height":g+"px",height:g+"px"})},s=function(){var b=[];b=g.call([{methodname:"local_notebook_notes_list",args:{userid:this.userid,courseid:this.courseid,coursemoduleid:this.coursemoduleid}}]);f.get_strings([{key:"notetitle",component:"local_notebook"},{key:"notecontext",component:"local_notebook"},{key:"notedate",component:"local_notebook"},{key:"displaynote",component:"local_notebook"}]).then(function(c){var d=document.querySelector("[data-region=\"right-hand-notebook-drawer\"]"),f=d.offsetHeight,g=460;if(800>f){g=300}else if(600>f){g=250}var h=[];b[0].done(function(b){a.each(b,function(a,b){var c={text:b.subject,tags:b.tags};h.push({id:b.id,subject:c,contextname:b.contextname,created:b.created})});this.$table.bootstrapTable({locale:document.documentElement.lang,paginationParts:["pageInfo","pageList"],paginationSuccessivelySize:2,paginationPagesBySide:1,data:h,height:g,columns:[[{field:"state",checkbox:!0},{field:"subject",title:c[0],sortable:!0,width:300,formatter:function(a){var b=a.tags.length,c="<span class='text-truncate subject'>"+a.text+"</span><br>",d=1===b?"wcn-1":"wcn-2";a.tags.forEach(function(a){c+="<span class=\"badge badge-info text-truncate context-note "+d+"\"><a title=\""+a.title+"\" href=\""+a.url+"\">"+a.title+"</a></span>"});return c}},{field:"contextname",title:c[1],sortable:!0},{field:"created",title:c[2],sortable:!0,formatter:function(a){var b=new Date(1e3*a).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"});return b},width:110},{field:"operate",title:"",align:"center",formatter:function(a,b){return["<a class=\"viewnote\" data-noteid=\""+b.id+"\" href=\"#\" title=\""+c[3]+"\">","<i class=\"fa fa-chevron-right\" aria-hidden=\"true\"></i>","</a>"].join("")}}]],onPostBody:function onPostBody(){r()}})}).fail(e.exception)}).fail(Notification.exception)},t=function(a){var b=w(a);if(b.length){c.hide(b)}},u=function(a){var b=w(a);if(b.length){return c.isVisible(b)}return!0},v=function(b){a(j.DRAWER).attr("data-origin",b)},w=function(b){b=a(b);return b.closest("[data-region=\"right-hand-notebook-drawer\"]")},x=function(){if("reset"==a(document.activeElement).data("action")){y()}else{var b={userid:i.userid,courseid:i.courseid,coursemoduleid:i.coursemoduleid,subject:a(j.NOTE_FORM+" input[name=\"subject\"]").val(),note:a(j.NOTE_FORM).serialize()};g.call([{methodname:"local_notebook_add_note",args:b,done:function done(a){if(!a.error){B();m()}},fail:e.exception}])}return!1},y=function(){a(j.NOTE_FORM+" input[name=\"subject\"]").val(a(j.NOTE_FORM+" input[name=\"subjectorigin\"]").val());a(j.NOTE_FORM+" textarea").val("");a(j.BODY_CONTAINER+" #id_noteeditable").html("");a(j.NOTE_FORM+" textarea").trigger("change");a(j.MESSAGE_SUCCESS_CONTAINER).html("")},z=function(b){a(j.HEADER_NOTE_VIEW).addClass("hidden");a(j.HEADER_NOTE_VIEW).attr("aria-hidden",!0);a(j.FOOTER_NOTE_VIEW).addClass("hidden");a(j.FOOTER_NOTE_VIEW).attr("aria-hidden",!0);a(j.NOTE_VIEW).addClass("hidden");a(j.NOTE_VIEW).attr("aria-hidden",!0);a(j.BODY_LIST).removeClass("hidden");a(j.BODY_LIST).removeAttr("aria-hidden");a(j.VIEW_NOTE+"[data-noteid=\""+b+"\"]").focus()},A=function(){a(j.HEADER_NOTE_VIEW).removeClass("hidden");a(j.HEADER_NOTE_VIEW).removeAttr("aria-hidden");a(j.FOOTER_NOTE_VIEW).removeClass("hidden");a(j.FOOTER_NOTE_VIEW).removeAttr("aria-hidden");a(j.NOTE_VIEW).removeClass("hidden");a(j.NOTE_VIEW).removeAttr("aria-hidden");a(j.BODY_LIST).addClass("hidden");a(j.BODY_LIST).attr("aria-hidden",!0)},B=function(){a(j.MESSAGE_SUCCESS_CONTAINER).html("");f.get_strings([{key:"notesaved",component:"local_notebook"},{key:"close",component:"core"}]).then(function(b){var c="<div class=\"alert alert-success alert-block fade in \" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\""+b[1]+"\">\xD7</button>"+b[0]+"</div>";a(j.MESSAGE_SUCCESS_CONTAINER).html(c)})},C=function(){var b=a(j.NOTE_FORM+" textarea").val(),c=!1;if(0===b.replace(/<(.|\n)*?>/g,"").trim().length&&!b.includes("<img")){c=!0}if(""==a(j.NOTE_FORM+" input[type=\"text\"]").val()||c){a(j.NOTE_FORM+" "+j.SAVE_BUTTON).prop("disabled",!0)}else{a(j.NOTE_FORM+" "+j.SAVE_BUTTON).prop("disabled",!1)}},D=function(e,f,g,h){this.userid=f;this.courseid=g;this.coursemoduleid=h;this.$table=a(j.NOTE_TABLE);a(j.DRAWER).on("click",j.REFRESH_BUTTON,function(){m()});b.define(e,[b.events.activate]);d.subscribe(k.SHOW,function(){l(e)});d.subscribe(k.HIDE,function(){t(e)});d.subscribe(k.TOGGLE_VISIBILITY,function(b){if(u(e)){t(e);a(j.JUMPTO).attr("tabindex",-1);Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.init({formid:j.NOTE_FORM_ID})});Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})}else{l(e);v(b);a(j.JUMPTO).attr("tabindex",0)}});a(j.JUMPTO).on("focus",function(){var b=e.find(j.CLOSE_BUTTON);if(b.length){b.focus()}else{a(j.HEADER_CONTAINER).find(j.ROUTES_BACK).focus()}});a(j.DRAWER).focus(function(){var b=a(this).attr("data-origin");if(b){a("#"+b).focus()}});var i=e.find(j.CLOSE_BUTTON);i.on(b.events.activate,function(b,c){c.originalEvent.preventDefault();var e=a(j.DRAWER).attr("data-origin");if(e){a("#"+e).focus()}d.publish(k.TOGGLE_VISIBILITY)});a(j.DRAWER).on("click",j.BACK_TO_LIST,function(){z(a(this).data("noteid"))});a(j.DRAWER).on("click",j.VIEW_NOTE,function(){q(a(this).data("noteid"))});var n=c.getDrawerRoot(a("[data-region=\"message-drawer\"]")),o=a("[id^=\"message-drawer-toggle-\"]");o.on("click keydown keypress",function(){var a=event.keyCode?event.keyCode:event.which;if("13"==a||"32"==a||"click"==event.type){if(c.isVisible(n)&&u(e)){t(e)}}});a(j.BODY_CONTAINER).on("submit","form",x);C();a(j.BODY_CONTAINER+" form input[type=\"text\"]").on("input",C);a(j.BODY_CONTAINER+" form textarea").on("change",C)};return{init:function init(b,c,d,e){b=a(b);D(b,c,d,e)}}});
//# sourceMappingURL=notebook_drawer.min.js.map
