require.config({enforceDefine:!0,shim:{bootstrapTable:["jquery"],bootstrapTableLocale:["jquery","bootstrapTable"],bootstrapTableLocaleMobile:["jquery","bootstrapTable"]},paths:{bootstrapTable:"/local/notebook/amd/build/bootstrap-table.min",bootstrapTableLocale:"/local/notebook/amd/build/bootstrap-table-locale-all.min",bootstrapTableLocaleMobile:"/local/notebook/amd/build/bootstrap-table-mobile.min"}});define ("local_notebook/notebook_index",["jquery","core/notification","core/str","core/ajax","core/templates","bootstrapTable","bootstrapTableLocale","bootstrapTableLocaleMobile"],function(a,b,c,d,e){var f=this,g={NOTEBOOKCONTAINER:".notebookcontainer",NOTEINDEX:"[data-region=\"notebook-index\"]",HEADER_CONTAINER:"[data-region=\"header-container\"]",BODY_CONTAINER:"[data-region=\"body-container\"]",FORM_CONTAINER:"[data-region=\"form-note\"]",CLOSE_BUTTON:"[data-action=\"closedrawer\"]",NOTE_TABLE:"#notebook-table-index",REFRESH_BUTTON:"button[name=\"refresh\"]",SAVE_BUTTON:"#savenote",RESET_BUTTON:"#resetnote",NOTE_FORM_ID:"noteform",VIEW_NOTE:"#notebook-table-index .viewnote",NOTE_VIEW:"[data-region=\"notebook-index\"] .view-note",FOOTER_NOTE_VIEW:"[data-region=\"footer-container\"] [data-region=\"view-note\"]",HEADER_NOTE_VIEW:"[data-region=\"header-container\"] [data-region=\"view-note\"]",HEADER_NOTE_DATE:"[data-region=\"header-container\"] .notedate",NOTE_FORM:"[data-region=\"form-note\"] #noteform",FOOTER_NOTE_DELETE:"[data-region=\"footer-container\"] .deletenote",FOOTER_NOTE_EDIT:"[data-region=\"footer-container\"] .editnote",FOOTER_NOTE_TAGS:"[data-region=\"footer-container\"] .notetags",MESSAGE_SUCCESS_CONTAINER:".notebookcontainer .messagesuccesscontainer",DIALOGUE_CONTAINER:".notebookcontainer [data-region=\"confirm-dialogue-container\"]",CONFIRM_TEXT_MULTI:".notebookcontainer [data-region=\"confirm-dialogue-container\"] .multiplenotes",CONFIRM_TEXT_SINGLE:".notebookcontainer [data-region=\"confirm-dialogue-container\"] .singlenote",CONFIRM_DELETE_BUTTON_MULTI:"[data-region=\"confirm-dialogue-container\"] [data-action=\"confirm-delete-multiple\"]",CONFIRM_DELETE_BUTTON_SINGLE:"[data-region=\"confirm-dialogue-container\"] [data-action=\"confirm-delete-single\"]",CANCEL_DELETE_BUTTON_MULTI:"[data-region=\"confirm-dialogue-container\"] [data-action=\"cancel-delete-multiple\"]",CANCEL_DELETE_BUTTON_SINGLE:"[data-region=\"confirm-dialogue-container\"] [data-action=\"cancel-delete-single\"]",DELETE_NOTE_BUTTON:".deletenote",CHECKBOX_LIST_NOTE:"[name=\"btSelectItem\"]",CHECKBOX_ALL_NOTE:"[name=\"btSelectAll\"]",TABLE_DELETE_BUTTON:"[data-region=\"notebook-index\"] #remove"},h=function(){f.$table.bootstrapTable("destroy");m()},i=function(a){var b="";a.forEach(function(a){b+="<span class=\"badge badge-info text-truncate context-note\"><a title=\""+a.title+"\" href=\""+a.url+"\">"+a.title+"</a></span>"});return b},j=function(){var b=g.FOOTER_NOTE_VIEW+", "+g.HEADER_NOTE_DATE+", "+g.NOTE_VIEW;a(b).addClass("blur-content")},k=function(){var b=g.FOOTER_NOTE_VIEW+", "+g.HEADER_NOTE_DATE+", "+g.NOTE_VIEW;a(b).removeClass("blur-content")},l=function(b){var c=[];u();j();c=d.call([{methodname:"local_notebook_read_note",args:{noteid:b}},{methodname:"local_notebook_note_viewed",args:{id:b}}]);c[0].done(function(b){var d={subject:b.subject,summary:b.summary},f=1e3*b.created,h=new Date(f).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"}),j=new Date(f).toLocaleTimeString(document.documentElement.lang);e.render("local_notebook/note_content",d).then(function(d){a(g.NOTE_VIEW).html(d);a(g.HEADER_NOTE_DATE).html(h+" "+j);a(g.FOOTER_NOTE_DELETE).data("noteid",b.id);a(g.FOOTER_NOTE_EDIT).data("noteid",b.id);a(g.FOOTER_NOTE_TAGS).html(i(b.tags));k();c[1].done(function(){}).fail(Notification.exception)}).fail(Notification.exception)}).fail(Notification.exception)},m=function(){var e=[];e=d.call([{methodname:"local_notebook_notes_list",args:{userid:f.userid,courseid:f.courseid,coursemoduleid:f.coursemoduleid}}]);c.get_strings([{key:"notetitle",component:"local_notebook"},{key:"notecontext",component:"local_notebook"},{key:"notedate",component:"local_notebook"},{key:"displaynote",component:"local_notebook"}]).then(function(c){var d=[];e[0].done(function(b){a.each(b,function(a,b){var c={text:b.subject,tags:b.tags};d.push({id:b.id,subject:c,contextname:b.contextname,created:b.created})});this.$table.bootstrapTable({locale:document.documentElement.lang,paginationParts:["pageInfo","pageList"],paginationSuccessivelySize:2,paginationPagesBySide:1,data:d,columns:[[{field:"state",checkbox:!0},{field:"subject",title:c[0],sortable:!0,width:300,formatter:function formatter(a){var b=a.tags.length,c="<span class='text-truncate subject'>"+a.text+"</span><br>",d=1===b?"wcn-1":"wcn-2";a.tags.forEach(function(a){c+="<span class=\"badge badge-info text-truncate context-note "+d+"\"><a title=\""+a.title+"\" href=\""+a.url+"\">"+a.title+"</a></span>"});return c}},{field:"contextname",title:c[1],sortable:!0},{field:"created",title:c[2],sortable:!0,formatter:function formatter(a){var b=new Date(1e3*a).toLocaleDateString(document.documentElement.lang,{day:"numeric",month:"short",year:"numeric"});return b},width:110},{field:"operate",title:"",align:"center",formatter:function formatter(a,b){return["<a class=\"viewnote\" data-noteid=\""+b.id+"\" href=\"#notedetailcontainer\" title=\""+c[3]+"\">","<i class=\"fa fa-chevron-right\" aria-hidden=\"true\"></i>","</a>"].join("")}}]]})}).fail(b.exception)}).fail(Notification.exception)},n=function(b,c){a(g.DIALOGUE_CONTAINER).addClass("hidden");if(!c){return}if("multiple"===b){a(g.TABLE_DELETE_BUTTON).focus()}else{a(g.DELETE_NOTE_BUTTON).focus()}},o=function(b){a(g.DIALOGUE_CONTAINER).removeClass("hidden");if("multiple"===b){var c=g.CONFIRM_TEXT_MULTI+", "+g.CONFIRM_DELETE_BUTTON_MULTI+","+g.CANCEL_DELETE_BUTTON_MULTI,d=g.CONFIRM_TEXT_SINGLE+", "+g.CONFIRM_DELETE_BUTTON_SINGLE+","+g.CANCEL_DELETE_BUTTON_SINGLE;a(d).addClass("hidden");a(c).removeClass("hidden");var h=[];a(g.NOTEINDEX+" "+g.CHECKBOX_LIST_NOTE+":checked").each(function(){h.push(a(this).val())});a(g.CONFIRM_DELETE_BUTTON_MULTI).data("noteid",h);a(g.CONFIRM_DELETE_BUTTON_MULTI).focus()}else{var e=g.CONFIRM_TEXT_MULTI+", "+g.CONFIRM_DELETE_BUTTON_MULTI+","+g.CANCEL_DELETE_BUTTON_MULTI,f=g.CONFIRM_TEXT_SINGLE+", "+g.CONFIRM_DELETE_BUTTON_SINGLE+","+g.CANCEL_DELETE_BUTTON_SINGLE;a(e).addClass("hidden");a(f).removeClass("hidden");a(g.CONFIRM_DELETE_BUTTON_SINGLE).data("noteid",a(g.FOOTER_NOTE_DELETE).data("noteid"));a(g.CONFIRM_DELETE_BUTTON_SINGLE).focus()}window.scrollTo(0,a(g.DIALOGUE_CONTAINER).position().top)},p=function(){if("reset"==a(document.activeElement).data("action")){r()}else{var c={noteid:a(g.NOTE_FORM+" input[name=\"noteid\"]").val(),subject:a(g.NOTE_FORM+" input[name=\"subject\"]").val(),note:a(g.NOTE_FORM).serialize()};d.call([{methodname:"local_notebook_update_note",args:c,done:function done(a){if(a){h();w("notesaved");u();l(c.noteid)}},fail:b.exception}])}return!1},q=function(){var c=a(document.activeElement).data("action"),e=[],f="notedeleted";if("confirm-delete-multiple"===c){e=a(document.activeElement).data("noteid");f="notedeletedmultiple"}else{e.push(a(document.activeElement).data("noteid"))}d.call([{methodname:"local_notebook_delete_notes",args:{notes:e},done:function done(a){if(a){n("multiple",!1);s(!1);w(f);h();t()}},fail:b.exception}]);return!1},r=function(){u();a(g.FOOTER_NOTE_EDIT).focus()},s=function(b){a(g.HEADER_NOTE_VIEW).addClass("hidden");a(g.HEADER_NOTE_VIEW).attr("aria-hidden",!0);a(g.FOOTER_NOTE_VIEW).addClass("hidden");a(g.FOOTER_NOTE_VIEW).attr("aria-hidden",!0);a(g.NOTE_VIEW).addClass("hidden");a(g.NOTE_VIEW).attr("aria-hidden",!0);a(g.FORM_CONTAINER).removeClass("hidden");a(g.FORM_CONTAINER).removeAttr("aria-hidden");if(!b){return}a(b).focus()},t=function(){a(g.FORM_CONTAINER).addClass("hidden");a(g.FORM_CONTAINER).attr("aria-hidden",!0)},u=function(){a(g.HEADER_NOTE_VIEW).removeClass("hidden");a(g.HEADER_NOTE_VIEW).removeAttr("aria-hidden");a(g.FOOTER_NOTE_VIEW).removeClass("hidden");a(g.FOOTER_NOTE_VIEW).removeAttr("aria-hidden");a(g.NOTE_VIEW).removeClass("hidden");a(g.NOTE_VIEW).removeAttr("aria-hidden");a(g.FORM_CONTAINER).addClass("hidden");a(g.FORM_CONTAINER).attr("aria-hidden",!0)},v=function(c){d.call([{methodname:"local_notebook_read_note",args:{noteid:c},done:function done(b){if(b){a(g.FORM_CONTAINER+" #id_noteeditable").html(b.summary);a(g.NOTE_FORM+" textarea").val(a(g.NOTE_VIEW+" .textareaorigin").val());a(g.NOTE_FORM+" textarea").trigger("change");a(g.NOTE_FORM+" input[name=\"subject\"]").val(b.subject);a(g.NOTE_FORM+" input[name=\"noteid\"]").val(c);s(g.NOTE_FORM+" input[name=\"subject\"]");x()}},fail:b.exception}])},w=function(b){a(g.MESSAGE_SUCCESS_CONTAINER).html("");c.get_strings([{key:b,component:"local_notebook"},{key:"close",component:"core"}]).then(function(b){var c="<div class=\"alert alert-success alert-block fade in \" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\""+b[1]+"\">\xD7</button>"+b[0]+"</div>";a(g.MESSAGE_SUCCESS_CONTAINER).html(c);a(g.MESSAGE_SUCCESS_CONTAINER+" .alert button").focus()})},x=function(){var b=a(g.FORM_CONTAINER+" #id_noteeditable").html(),c=!1,d=a(g.NOTE_FORM+" input[name=\"noteid\"]").val(),e=!1;if("0"!==d){var f=a(g.NOTE_FORM+" input[type=\"text\"]").val(),h=a(g.NOTEINDEX+" .titlenote").html(),i=a(g.NOTEINDEX+" .summarynote").html();if(0===f.localeCompare(h)&&0===b.localeCompare(i)){e=!0}}if(0===b.replace(/<(.|\n)*?>/g,"").trim().length&&!b.includes("<img")){c=!0}if(""==a(g.NOTE_FORM+" input[type=\"text\"]").val()||c||e){a(g.NOTE_FORM+" "+g.SAVE_BUTTON).prop("disabled",!0)}else{a(g.NOTE_FORM+" "+g.SAVE_BUTTON).prop("disabled",!1)}},y=function(){var b=!0;if(0<a(g.NOTEINDEX+" "+g.CHECKBOX_LIST_NOTE+":checked").length){b=!1}if(b){a(g.TABLE_DELETE_BUTTON).prop("disabled",!0)}else{a(g.TABLE_DELETE_BUTTON).prop("disabled",!1)}},z=function(b,c,d){f.userid=b;f.courseid=c;f.coursemoduleid=d;f.$table=a(g.NOTE_TABLE);a(g.NOTEINDEX).on("click",g.REFRESH_BUTTON,function(){h()});a(g.NOTEINDEX).on("click",g.VIEW_NOTE,function(){a(g.NOTEINDEX+" #notebook-table-index tr.selected").removeClass("selected");l(a(this).data("noteid"));a(this).closest("tr").addClass("selected")});a(g.NOTEINDEX).on("click",g.FOOTER_NOTE_EDIT,function(){v(a(this).data("noteid"))});a(g.NOTEBOOKCONTAINER).on("click",g.CANCEL_DELETE_BUTTON_SINGLE,function(){n("single",!0)});a(g.NOTEBOOKCONTAINER).on("click",g.CANCEL_DELETE_BUTTON_MULTI,function(){n("multiple",!0)});a(g.NOTEINDEX).on("click",g.DELETE_NOTE_BUTTON,function(){var b="multiple";if(a(this).data("noteid")){b="single"}o(b)});a(g.NOTEBOOKCONTAINER).on("click",g.CONFIRM_DELETE_BUTTON_SINGLE+" , "+g.CONFIRM_DELETE_BUTTON_MULTI,q);a(g.FORM_CONTAINER).on("submit","form",p);a(g.FORM_CONTAINER+" form input[type=\"text\"]").on("input",x);a(g.FORM_CONTAINER+" form textarea").on("change",x);a(g.NOTEINDEX).on("change",g.CHECKBOX_LIST_NOTE+", "+g.CHECKBOX_ALL_NOTE,y)};return{init:function init(b,c,d){z(b,c,d);a(document).ready(function(){m()})}}});
//# sourceMappingURL=notebook_index.min.js.map
