{"version":3,"sources":["../src/notebook_drawer.js"],"names":["define","$","CustomEvents","Drawer","PubSub","SELECTORS","JUMPTO","DRAWER","HEADER_CONTAINER","BODY_CONTAINER","CLOSE_BUTTON","Events","SHOW","HIDE","TOGGLE_VISIBILITY","show","root","attr","drawerRoot","getDrawerRoot","length","hide","isVisible","setJumpFrom","buttonid","contentRoot","closest","registerEventListeners","events","activate","subscribe","on","firstInput","find","focus","ROUTES_BACK","button","closebutton","e","data","originalEvent","preventDefault","publish","msdrawerRoot","messagetoggler","keycode","event","keyCode","which","type","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Controls the notebook drawer.\n *\n * @module     local_notebook/notebook_drawer\n * @copyright  2022 Université de Montréal\n * @author     Issam Taboubi <issam.taboubi@umontreal.ca>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n[\n    'jquery',\n    'core/custom_interaction_events',\n    'core/drawer',\n    'core/pubsub'\n],\nfunction(\n    $,\n    CustomEvents,\n    Drawer,\n    PubSub\n) {\n\n    var SELECTORS = {\n        JUMPTO: '.notebookbutton [data-region=\"jumpto\"]',\n        DRAWER: '[data-region=\"right-hand-notebook-drawer\"]',\n        HEADER_CONTAINER: '[data-region=\"header-container\"]',\n        BODY_CONTAINER: '[data-region=\"body-container\"]',\n        CLOSE_BUTTON: '[data-action=\"closedrawer\"]'\n    };\n    var Events = {\n        SHOW: 'notebook-drawer-show',\n        HIDE: 'notebook-drawer-hide',\n        TOGGLE_VISIBILITY: 'notebook-drawer-toggle',\n    };\n\n    /**\n     * Show the Notebook drawer.\n     *\n     * @param {Object} root The notebook drawer container.\n     */\n    var show = function(root) {\n        if (!root.attr('data-shown')) {\n            root.attr('data-shown', true);\n        }\n\n        var drawerRoot = getDrawerRoot(root);\n        if (drawerRoot.length) {\n            Drawer.show(drawerRoot);\n        }\n    };\n\n    /**\n     * Hide the notebook drawer.\n     *\n     * @param {Object} root The notebook drawer container.\n     */\n    var hide = function(root) {\n        var drawerRoot = getDrawerRoot(root);\n        if (drawerRoot.length) {\n            Drawer.hide(drawerRoot);\n        }\n    };\n\n    /**\n     * Check if the drawer is visible.\n     *\n     * @param {Object} root The notebook drawer container.\n     * @return {boolean}\n     */\n    var isVisible = function(root) {\n        var drawerRoot = getDrawerRoot(root);\n        if (drawerRoot.length) {\n            return Drawer.isVisible(drawerRoot);\n        }\n        return true;\n    };\n\n    /**\n     * Set Jump from button\n     *\n     * @param {String} buttonid The originating button id\n     */\n    var setJumpFrom = function(buttonid) {\n        $(SELECTORS.DRAWER).attr('data-origin', buttonid);\n    };\n\n    /**\n     * Find the root element of the drawer based on the using the drawer content root's ID.\n     *\n     * @param {Object} contentRoot The drawer content's root element.\n     * @returns {*|jQuery}\n     */\n    var getDrawerRoot = (contentRoot) => {\n        contentRoot = $(contentRoot);\n        return contentRoot.closest('[data-region=\"right-hand-notebook-drawer\"]');\n    };\n\n    /**\n     * Listen to showing and hiding the notebook drawer.\n     *\n     * @param {Object} root The notebook drawer container.\n     */\n    var registerEventListeners = function(root) {\n        CustomEvents.define(root, [CustomEvents.events.activate]);\n        PubSub.subscribe(Events.SHOW, function() {\n            show(root);\n        });\n\n        PubSub.subscribe(Events.HIDE, function() {\n            hide(root);\n        });\n\n        PubSub.subscribe(Events.TOGGLE_VISIBILITY, function(buttonid) {\n            if (isVisible(root)) {\n                hide(root);\n                $(SELECTORS.JUMPTO).attr('tabindex', -1);\n            } else {\n                show(root);\n                setJumpFrom(buttonid);\n                $(SELECTORS.JUMPTO).attr('tabindex', 0);\n            }\n        });\n\n        $(SELECTORS.JUMPTO).on('focus', function() {\n            var firstInput = root.find(SELECTORS.CLOSE_BUTTON);\n            if (firstInput.length) {\n                firstInput.focus();\n            } else {\n                $(SELECTORS.HEADER_CONTAINER).find(SELECTORS.ROUTES_BACK).focus();\n            }\n        });\n\n        $(SELECTORS.DRAWER).focus(function() {\n            var button = $(this).attr('data-origin');\n            if (button) {\n                $('#' + button).focus();\n            }\n        });\n\n        var closebutton = root.find(SELECTORS.CLOSE_BUTTON);\n        closebutton.on(CustomEvents.events.activate, function(e, data) {\n            data.originalEvent.preventDefault();\n            var button = $(SELECTORS.DRAWER).attr('data-origin');\n            if (button) {\n                $('#' + button).focus();\n            }\n            PubSub.publish(Events.TOGGLE_VISIBILITY);\n        });\n\n        // If notebook draer is visible and we open message drawer, hide notebook.\n        var msdrawerRoot = Drawer.getDrawerRoot($('[data-region=\"message-drawer\"]'));\n        var messagetoggler = $('[id^=\"message-drawer-toggle-\"]');\n        messagetoggler.on('click keydown keypress', function() {\n            var keycode = (event.keyCode ? event.keyCode :  event.which);\n            // Enter, space or click.\n            if(keycode == '13' || keycode == '32' || event.type == 'click'){\n                if(Drawer.isVisible(msdrawerRoot) && isVisible(root)) {\n                    hide(root);\n                }\n            }\n        });\n    };\n\n    /**\n     * Initialise the notebook drawer.\n     *\n     * @param {Object} root The notebook drawer container.\n     */\n    var init = function(root) {\n        root = $(root);\n        registerEventListeners(root);\n    };\n\n    return {\n        init: init,\n    };\n});\n"],"file":"notebook_drawer.min.js"}