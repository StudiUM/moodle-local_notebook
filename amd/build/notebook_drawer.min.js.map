{"version":3,"sources":["../src/notebook_drawer.js"],"names":["require","config","enforceDefine","shim","paths","bootstrapTable","bootstrapTableLocale","bootstrapTableLocaleMobile","define","$","CustomEvents","Drawer","PubSub","notification","str","ajax","Templates","SELECTORS","JUMPTO","DRAWER","HEADER_CONTAINER","BODY_CONTAINER","BODY_LIST","CLOSE_BUTTON","NOTE_TABLE","REFRESH_BUTTON","SAVE_BUTTON","RESET_BUTTON","NOTE_FORM_ID","VIEW_NOTE","BACK_TO_LIST","NOTE_VIEW","FOOTER_NOTE_VIEW","HEADER_NOTE_VIEW","HEADER_NOTE_DATE","NOTE_FORM","FOOTER_NOTE_DELETE","FOOTER_NOTE_EDIT","FOOTER_NOTE_TAGS","MESSAGE_SUCCESS_CONTAINER","Events","SHOW","HIDE","TOGGLE_VISIBILITY","show","root","attr","drawerRoot","getDrawerRoot","length","displayNotes","refreshNotes","$table","getFormattedTags","tags","tagshtml","forEach","item","title","url","addBlurContent","selectors","addClass","removeBlurContent","removeClass","displayNote","noteid","promises","displayNoteView","call","methodname","args","id","done","result","data","subject","summary","timestamp","created","datecreation","Date","toLocaleDateString","document","documentElement","lang","day","month","year","timecreation","toLocaleTimeString","render","then","html","focus","fail","Notification","exception","resizeEditor","heightcontainer","outerHeight","heightlistnote","heightsubject","heightbutton","heighttoolbareditor","heighteditor","css","userid","courseid","coursemoduleid","get_strings","key","component","langStrings","box","querySelector","height","offsetHeight","tableheight","each","index","value","text","push","contextname","locale","paginationParts","paginationSuccessivelySize","paginationPagesBySide","columns","field","checkbox","sortable","width","formatter","nbtags","td","nbclass","today","align","row","join","onPostBody","hide","isVisible","setJumpFrom","buttonid","contentRoot","closest","submitFormAjax","activeElement","resetNoteForm","val","note","serialize","error","displayMessageSuccess","trigger","hideNoteView","removeAttr","messageHtml","toggleSaveButton","editorcontent","emptyeditor","replace","trim","includes","prop","registerEventListeners","on","events","activate","subscribe","Y","use","M","core_formchangechecker","init","formid","reset_form_dirty_state","firstInput","find","ROUTES_BACK","button","closebutton","e","originalEvent","preventDefault","publish","msdrawerRoot","messagetoggler","keycode","event","keyCode","which","type"],"mappings":"AAuBAA,OAAO,CAACC,MAAR,CAAe,CACXC,aAAa,GADF,CAEXC,IAAI,CAAE,CACF,eAAkB,CAAC,QAAD,CADhB,CAEF,qBAAwB,CAAC,QAAD,CAAW,gBAAX,CAFtB,CAGF,2BAA8B,CAAC,QAAD,CAAW,gBAAX,CAH5B,CAFK,CAOXC,KAAK,CAAE,CACHC,cAAc,CAAE,+CADb,CAEHC,oBAAoB,CAAE,0DAFnB,CAGHC,0BAA0B,CAAE,sDAHzB,CAPI,CAAf,EAcAC,OAAM,kCACF,CACI,QADJ,CAEI,gCAFJ,CAGI,aAHJ,CAII,aAJJ,CAKI,mBALJ,CAMI,UANJ,CAOI,WAPJ,CAQI,gBARJ,CASI,gBATJ,CAUI,sBAVJ,CAWI,4BAXJ,CADE,CAcF,SACIC,CADJ,CAEIC,CAFJ,CAGIC,CAHJ,CAIIC,CAJJ,CAKIC,CALJ,CAMIC,CANJ,CAOIC,CAPJ,CAQIC,CARJ,CASE,YAEMC,CAAS,CAAG,CACZC,MAAM,CAAE,0CADI,CAEZC,MAAM,CAAE,8CAFI,CAGZC,gBAAgB,CAAE,oCAHN,CAIZC,cAAc,CAAE,kCAJJ,CAKZC,SAAS,CAAE,iCALC,CAMZC,YAAY,CAAE,+BANF,CAOZC,UAAU,CAAE,iBAPA,CAQZC,cAAc,CAAE,0BARJ,CASZC,WAAW,CAAE,WATD,CAUZC,YAAY,CAAE,YAVF,CAWZC,YAAY,CAAE,UAXF,CAYZC,SAAS,CAAE,4DAZC,CAaZC,YAAY,CAAE,gDAbF,CAcZC,SAAS,CAAE,8DAdC,CAeZC,gBAAgB,CAAE,gEAfN,CAgBZC,gBAAgB,CAAE,gEAhBN,CAiBZC,gBAAgB,CAAE,8CAjBN,CAkBZC,SAAS,CAAE,4CAlBC,CAmBZC,kBAAkB,CAAE,gDAnBR,CAoBZC,gBAAgB,CAAE,8CApBN,CAqBZC,gBAAgB,CAAE,8CArBN,CAsBZC,yBAAyB,CAAE,wFAtBf,CAFlB,CA0BMC,CAAM,CAAG,CACTC,IAAI,CAAE,sBADG,CAETC,IAAI,CAAE,sBAFG,CAGTC,iBAAiB,CAAE,wBAHV,CA1Bf,CAsCMC,CAAI,CAAG,SAAUC,CAAV,CAAgB,CACvB,GAAI,CAACA,CAAI,CAACC,IAAL,CAAU,YAAV,CAAL,CAA8B,CAC1BD,CAAI,CAACC,IAAL,CAAU,YAAV,IACH,CAED,GAAIC,CAAAA,CAAU,CAAGC,CAAa,CAACH,CAAD,CAA9B,CACA,GAAIE,CAAU,CAACE,MAAf,CAAuB,CACnBtC,CAAM,CAACiC,IAAP,CAAYG,CAAZ,EAEAG,CAAY,EACf,CACJ,CAjDH,CAuDMC,CAAY,CAAG,UAAY,CAC3B,KAAKC,MAAL,CAAY/C,cAAZ,CAA2B,SAA3B,EACA6C,CAAY,EACf,CA1DH,CAkEMG,CAAgB,CAAG,SAASC,CAAT,CAAe,CAClC,GAAIC,CAAAA,CAAQ,CAAG,EAAf,CAEAD,CAAI,CAACE,OAAL,CAAa,SAASC,CAAT,CAAe,CACxBF,CAAQ,EAAI,0EACSE,CAAI,CAACC,KADd,CACsB,YADtB,CACmCD,CAAI,CAACE,GADxC,CAC8C,KAD9C,CACqDF,CAAI,CAACC,KAD1D,CACkE,aACjF,CAHD,EAKA,MAAOH,CAAAA,CACV,CA3EH,CAiFMK,CAAc,CAAG,UAAY,CAC7B,GAAIC,CAAAA,CAAS,CAAG5C,CAAS,CAACe,gBAAV,CAA6B,IAA7B,CAAoCf,CAAS,CAACiB,gBAA9C,CAAiE,IAAjE,CAAwEjB,CAAS,CAACc,SAAlG,CACAtB,CAAC,CAACoD,CAAD,CAAD,CAAaC,QAAb,CAAsB,cAAtB,CACH,CApFH,CA0FMC,CAAiB,CAAG,UAAY,CAChC,GAAIF,CAAAA,CAAS,CAAG5C,CAAS,CAACe,gBAAV,CAA6B,IAA7B,CAAoCf,CAAS,CAACiB,gBAA9C,CAAiE,IAAjE,CAAwEjB,CAAS,CAACc,SAAlG,CACAtB,CAAC,CAACoD,CAAD,CAAD,CAAaG,WAAb,CAAyB,cAAzB,CACH,CA7FH,CAoGMC,CAAW,CAAG,SAAUC,CAAV,CAAkB,CAChC,GAAIC,CAAAA,CAAQ,CAAG,EAAf,CACAC,CAAe,GACfR,CAAc,GAEdO,CAAQ,CAAGpD,CAAI,CAACsD,IAAL,CAAU,CAAC,CAClBC,UAAU,CAAE,0BADM,CAElBC,IAAI,CAAE,CACFL,MAAM,CAAEA,CADN,CAFY,CAAD,CAMrB,CACII,UAAU,CAAE,4BADhB,CAEIC,IAAI,CAAE,CACFC,EAAE,CAAEN,CADF,CAFV,CANqB,CAAV,CAAX,CAYAC,CAAQ,CAAC,CAAD,CAAR,CAAYM,IAAZ,CAAiB,SAAUC,CAAV,CAAkB,IAC3BC,CAAAA,CAAI,CAAG,CACNC,OADM,CACIF,CAAM,CAACE,OADX,CAENC,OAFM,CAEIH,CAAM,CAACG,OAFX,CADoB,CAI3BC,CAAS,CAAoB,GAAjB,CAAAJ,CAAM,CAACK,OAJQ,CAK3BC,CAAY,CAAG,GAAIC,CAAAA,IAAJ,CAASH,CAAT,EAAoBI,kBAApB,CAAuCC,QAAQ,CAACC,eAAT,CAAyBC,IAAhE,CAAsE,CACrFC,GAAG,CAAG,SAD+E,CAErFC,KAAK,CAAG,OAF6E,CAGrFC,IAAI,CAAG,SAH8E,CAAtE,CALY,CAU3BC,CAAY,CAAG,GAAIR,CAAAA,IAAJ,CAASH,CAAT,EAAoBY,kBAApB,CAAuCP,QAAQ,CAACC,eAAT,CAAyBC,IAAhE,CAVY,CAW/BrE,CAAS,CAAC2E,MAAV,CAAiB,6BAAjB,CAAgDhB,CAAhD,EACCiB,IADD,CACM,SAASC,CAAT,CAAe,CAEjBpF,CAAC,CAACQ,CAAS,CAACc,SAAX,CAAD,CAAuB8D,IAAvB,CAA4BA,CAA5B,EAEApF,CAAC,CAACQ,CAAS,CAACiB,gBAAX,CAAD,CAA8B2D,IAA9B,CAAmCb,CAAY,CAAG,GAAf,CAAqBS,CAAxD,EAEAhF,CAAC,CAACQ,CAAS,CAACmB,kBAAX,CAAD,CAAgCuC,IAAhC,CAAqC,QAArC,CAA+CD,CAAM,CAACF,EAAtD,EACA/D,CAAC,CAACQ,CAAS,CAACoB,gBAAX,CAAD,CAA8BsC,IAA9B,CAAmC,QAAnC,CAA6CD,CAAM,CAACF,EAApD,EAEA/D,CAAC,CAACQ,CAAS,CAACqB,gBAAX,CAAD,CAA8BuD,IAA9B,CAAmCxC,CAAgB,CAACqB,CAAM,CAACpB,IAAR,CAAnD,EAEAS,CAAiB,GAEjBtD,CAAC,CAACQ,CAAS,CAACa,YAAX,CAAD,CAA0B6C,IAA1B,CAA+B,QAA/B,CAAyCD,CAAM,CAACF,EAAhD,EACA/D,CAAC,CAACQ,CAAS,CAACa,YAAX,CAAD,CAA0BgE,KAA1B,GAEA3B,CAAQ,CAAC,CAAD,CAAR,CAAYM,IAAZ,CAAiB,UAAY,CAAE,CAA/B,EAAiCsB,IAAjC,CAAsCC,YAAY,CAACC,SAAnD,CAEH,CAnBD,EAoBCF,IApBD,CAoBMC,YAAY,CAACC,SApBnB,CAqBH,CAhCD,EAgCGF,IAhCH,CAgCQC,YAAY,CAACC,SAhCrB,CAiCH,CAtJH,CA4JMC,CAAY,CAAG,UAAY,IACvBC,CAAAA,CAAe,CAAG1F,CAAC,CAACQ,CAAS,CAACI,cAAX,CAAD,CAA4B+E,WAA5B,IADK,CAEvBC,CAAc,CAAG5F,CAAC,CAACQ,CAAS,CAACI,cAAV,CAA2B,uBAA5B,CAAD,CAAsD+E,WAAtD,IAFM,CAGvBE,CAAa,CAAG7F,CAAC,CAACQ,CAAS,CAACI,cAAV,CAA2B,oBAA5B,CAAD,CAAmD+E,WAAnD,IAHO,CAIvBG,CAAY,CAAG9F,CAAC,CAACQ,CAAS,CAACI,cAAV,CAA2B,yBAA5B,CAAD,CAAwD+E,WAAxD,IAJQ,CAKvBI,CAAmB,CAAG/F,CAAC,CAACQ,CAAS,CAACI,cAAV,CAA2B,mBAA5B,CAAD,CAAkD+E,WAAlD,IALC,CAOvBK,CAAY,CAAGN,CAAe,CAAGE,CAAlB,CAAmCC,CAAnC,CAAmDC,CAAnD,CAAkEC,CAAlE,CADN,EANc,CAQ3B,GAAmB,GAAf,CAAAC,CAAJ,CAAwB,CACpBA,CAAY,CAAG,GAClB,CAEDhG,CAAC,CAACQ,CAAS,CAACI,cAAV,CAA0B,mBAA3B,CAAD,CAAiDqF,GAAjD,CAAsD,CAClD,aAAeD,CAAY,CAAG,IADoB,CAElD,OAAWA,CAAY,CAAG,IAFwB,CAAtD,CAIH,CA5KH,CAkLMvD,CAAY,CAAG,UAAY,CAC3B,GAAIiB,CAAAA,CAAQ,CAAG,EAAf,CAEAA,CAAQ,CAAGpD,CAAI,CAACsD,IAAL,CAAU,CAAC,CAClBC,UAAU,CAAE,2BADM,CAElBC,IAAI,CAAE,CACFoC,MAAM,CAAE,KAAKA,MADX,CAEFC,QAAQ,CAAE,KAAKA,QAFb,CAGFC,cAAc,CAAE,KAAKA,cAHnB,CAFY,CAAD,CAAV,CAAX,CA2BA/F,CAAG,CAACgG,WAAJ,CAnBiB,CACb,CACIC,GAAG,CAAE,WADT,CAEIC,SAAS,CAAE,gBAFf,CADa,CAKb,CACID,GAAG,CAAE,aADT,CAEIC,SAAS,CAAE,gBAFf,CALa,CASb,CACID,GAAG,CAAE,UADT,CAEIC,SAAS,CAAE,gBAFf,CATa,CAab,CACID,GAAG,CAAE,aADT,CAEIC,SAAS,CAAE,gBAFf,CAba,CAmBjB,EAA4BpB,IAA5B,CAAiC,SAASqB,CAAT,CAAsB,IAC/CC,CAAAA,CAAG,CAAG/B,QAAQ,CAACgC,aAAT,CAAuB,8CAAvB,CADyC,CAE/CC,CAAM,CAAGF,CAAG,CAACG,YAFkC,CAG/CC,CAAW,CAAG,GAHiC,CAInD,GAAa,GAAT,CAAAF,CAAJ,CAAkB,CACdE,CAAW,CAAG,GACjB,CAFD,IAEO,IAAa,GAAT,CAAAF,CAAJ,CAAkB,CACrBE,CAAW,CAAG,GACjB,CAED,GAAI3C,CAAAA,CAAI,CAAG,EAAX,CACAR,CAAQ,CAAC,CAAD,CAAR,CAAYM,IAAZ,CAAiB,SAAUC,CAAV,CAAkB,CAC/BjE,CAAC,CAAC8G,IAAF,CAAO7C,CAAP,CAAe,SAAU8C,CAAV,CAAiBC,CAAjB,CAAwB,CACnC,GAAI7C,CAAAA,CAAO,CAAG,CACN8C,IADM,CACCD,CAAK,CAAC7C,OADP,CAENtB,IAFM,CAECmE,CAAK,CAACnE,IAFP,CAAd,CAGAqB,CAAI,CAACgD,IAAL,CAAU,CACN,GAAMF,CAAK,CAACjD,EADN,CAEN,QAAWI,CAFL,CAGN,YAAe6C,CAAK,CAACG,WAHf,CAIN,QAAWH,CAAK,CAAC1C,OAJX,CAAV,CAMH,CAVD,EAWA,KAAK3B,MAAL,CAAY/C,cAAZ,CAA2B,CACvBwH,MAAM,CAAE1C,QAAQ,CAACC,eAAT,CAAyBC,IADV,CAEvByC,eAAe,CAAE,CAAC,UAAD,CAAa,UAAb,CAFM,CAGvBC,0BAA0B,CAAE,CAHL,CAIvBC,qBAAqB,CAAE,CAJA,CAKvBrD,IAAI,CAAEA,CALiB,CAMvByC,MAAM,CAAEE,CANe,CAOvBW,OAAO,CAAE,CACL,CAAC,CACGC,KAAK,CAAE,OADV,CAEGC,QAAQ,GAFX,CAAD,CAIA,CACID,KAAK,CAAE,SADX,CAEIxE,KAAK,CAAEuD,CAAW,CAAC,CAAD,CAFtB,CAGImB,QAAQ,GAHZ,CAIIC,KAAK,CAAE,GAJX,CAKIC,SAAS,CAgDrB,SAA0Bb,CAA1B,CAAiC,IACzBc,CAAAA,CAAM,CAAGd,CAAK,CAACnE,IAAN,CAAWL,MADK,CAEzBuF,CAAE,CAAG,uCAAyCf,CAAK,CAACC,IAA/C,CAAsD,aAFlC,CAGzBe,CAAO,CAAc,CAAX,GAAAF,CAAM,CAAS,OAAT,CAAmB,OAHV,CAI7Bd,CAAK,CAACnE,IAAN,CAAWE,OAAX,CAAmB,SAASC,CAAT,CAAe,CAC9B+E,CAAE,EAAI,6DAA8DC,CAA9D,CACA,gBADA,CACiBhF,CAAI,CAACC,KADtB,CAC8B,YAD9B,CAC2CD,CAAI,CAACE,GADhD,CACsD,KADtD,CAC6DF,CAAI,CAACC,KADlE,CAC0E,aACnF,CAHD,EAIA,MAAO8E,CAAAA,CACV,CA9DO,CAJA,CAWA,CACIN,KAAK,CAAE,aADX,CAEIxE,KAAK,CAAEuD,CAAW,CAAC,CAAD,CAFtB,CAGImB,QAAQ,GAHZ,CAXA,CAgBA,CACIF,KAAK,CAAE,SADX,CAEIxE,KAAK,CAAEuD,CAAW,CAAC,CAAD,CAFtB,CAGImB,QAAQ,GAHZ,CAIIE,SAAS,CAsBrB,SAAuBb,CAAvB,CAA8B,CAC1B,GAAIiB,CAAAA,CAAK,CAAG,GAAIzD,CAAAA,IAAJ,CAAiB,GAAR,CAAAwC,CAAT,EAAuBvC,kBAAvB,CAA0CC,QAAQ,CAACC,eAAT,CAAyBC,IAAnE,CAAyE,CACjFC,GAAG,CAAG,SAD2E,CAEjFC,KAAK,CAAG,OAFyE,CAGjFC,IAAI,CAAG,SAH0E,CAAzE,CAAZ,CAKA,MAAOkD,CAAAA,CACV,CAjCO,CAKIL,KAAK,CAAE,GALX,CAhBA,CAuBA,CACIH,KAAK,CAAE,SADX,CAEIxE,KAAK,CAAE,EAFX,CAGIiF,KAAK,CAAE,QAHX,CAIIL,SAAS,CA+CrB,SAA0Bb,CAA1B,CAAiCmB,CAAjC,CAAsC,CAClC,MAAO,CACH,uCAAsCA,CAAG,CAACpE,EAA1C,CAA+C,wBAA/C,CAAsEyC,CAAW,CAAC,CAAD,CAAjF,CAAuF,KADpF,CAEH,4DAFG,CAGH,MAHG,EAIL4B,IAJK,CAIA,EAJA,CAKV,CAzDO,CAvBA,CADK,CAPc,CAsCvBC,UAAU,CAAE,qBAAW,CAEnB5C,CAAY,EACf,CAzCsB,CAA3B,CA0FH,CAtGD,EAsGGH,IAtGH,CAsGQlF,CAAY,CAACoF,SAtGrB,CAuGH,CAlHD,EAkHGF,IAlHH,CAkHQC,YAAY,CAACC,SAlHrB,CAoHH,CApUH,CA2UM8C,CAAI,CAAG,SAAUlG,CAAV,CAAgB,CACvB,GAAIE,CAAAA,CAAU,CAAGC,CAAa,CAACH,CAAD,CAA9B,CACA,GAAIE,CAAU,CAACE,MAAf,CAAuB,CACnBtC,CAAM,CAACoI,IAAP,CAAYhG,CAAZ,CACH,CACJ,CAhVH,CAwVMiG,CAAS,CAAG,SAAUnG,CAAV,CAAgB,CAC5B,GAAIE,CAAAA,CAAU,CAAGC,CAAa,CAACH,CAAD,CAA9B,CACA,GAAIE,CAAU,CAACE,MAAf,CAAuB,CACnB,MAAOtC,CAAAA,CAAM,CAACqI,SAAP,CAAiBjG,CAAjB,CACV,CACD,QACH,CA9VH,CAqWMkG,CAAW,CAAG,SAAUC,CAAV,CAAoB,CAClCzI,CAAC,CAACQ,CAAS,CAACE,MAAX,CAAD,CAAoB2B,IAApB,CAAyB,aAAzB,CAAwCoG,CAAxC,CACH,CAvWH,CA+WMlG,CAAa,CAAG,SAACmG,CAAD,CAAiB,CACjCA,CAAW,CAAG1I,CAAC,CAAC0I,CAAD,CAAf,CACA,MAAOA,CAAAA,CAAW,CAACC,OAAZ,CAAoB,8CAApB,CACV,CAlXH,CAwXMC,CAAc,CAAG,UAAM,CACvB,GAAgD,OAA5C,EAAA5I,CAAC,CAAC0E,QAAQ,CAACmE,aAAV,CAAD,CAA0B3E,IAA1B,CAA+B,QAA/B,CAAJ,CAAyD,CACrD4E,CAAa,EAChB,CAFD,IAEO,CACH,GAAIhF,CAAAA,CAAI,CAAG,CACNoC,MADM,CACG,CAAI,CAACA,MADR,CAENC,QAFM,CAEK,CAAI,CAACA,QAFV,CAGNC,cAHM,CAGW,CAAI,CAACA,cAHhB,CAINjC,OAJM,CAIInE,CAAC,CAACQ,CAAS,CAACkB,SAAV,CAAqB,0BAAtB,CAAD,CAAiDqH,GAAjD,EAJJ,CAKNC,IALM,CAKChJ,CAAC,CAACQ,CAAS,CAACkB,SAAX,CAAD,CAAuBuH,SAAvB,EALD,CAAX,CAMA3I,CAAI,CAACsD,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,yBADL,CAEPC,IAAI,CAAEA,CAFC,CAGPE,IAAI,CAAE,cAASC,CAAT,CAAiB,CACnB,GAAI,CAACA,CAAM,CAACiF,KAAZ,CAAmB,CAEfC,CAAqB,GAErBzG,CAAY,EACf,CACJ,CAVM,CAWP4C,IAAI,CAAElF,CAAY,CAACoF,SAXZ,CAAD,CAAV,CAaH,CACD,QACH,CAjZH,CAuZMsD,CAAa,CAAG,UAAM,CACtB9I,CAAC,CAACQ,CAAS,CAACkB,SAAV,CAAqB,0BAAtB,CAAD,CAAiDqH,GAAjD,CAAqD/I,CAAC,CAACQ,CAAS,CAACkB,SAAV,CAAqB,gCAAtB,CAAD,CAAuDqH,GAAvD,EAArD,EACA/I,CAAC,CAACQ,CAAS,CAACkB,SAAV,CAAsB,WAAvB,CAAD,CAAqCqH,GAArC,CAAyC,EAAzC,EACA/I,CAAC,CAACQ,CAAS,CAACI,cAAV,CAA0B,mBAA3B,CAAD,CAAiDwE,IAAjD,CAAsD,EAAtD,EACApF,CAAC,CAACQ,CAAS,CAACkB,SAAV,CAAsB,WAAvB,CAAD,CAAqC0H,OAArC,CAA6C,QAA7C,EAEApJ,CAAC,CAACQ,CAAS,CAACsB,yBAAX,CAAD,CAAuCsD,IAAvC,CAA4C,EAA5C,CAEH,CA/ZH,CAsaMiE,CAAY,CAAG,SAAC5F,CAAD,CAAY,CAC3BzD,CAAC,CAACQ,CAAS,CAACgB,gBAAX,CAAD,CAA8B6B,QAA9B,CAAuC,QAAvC,EACArD,CAAC,CAACQ,CAAS,CAACgB,gBAAX,CAAD,CAA8Ba,IAA9B,CAAmC,aAAnC,KACArC,CAAC,CAACQ,CAAS,CAACe,gBAAX,CAAD,CAA8B8B,QAA9B,CAAuC,QAAvC,EACArD,CAAC,CAACQ,CAAS,CAACe,gBAAX,CAAD,CAA8Bc,IAA9B,CAAmC,aAAnC,KACArC,CAAC,CAACQ,CAAS,CAACc,SAAX,CAAD,CAAuB+B,QAAvB,CAAgC,QAAhC,EACArD,CAAC,CAACQ,CAAS,CAACc,SAAX,CAAD,CAAuBe,IAAvB,CAA4B,aAA5B,KACArC,CAAC,CAACQ,CAAS,CAACK,SAAX,CAAD,CAAuB0C,WAAvB,CAAmC,QAAnC,EACAvD,CAAC,CAACQ,CAAS,CAACK,SAAX,CAAD,CAAuByI,UAAvB,CAAkC,aAAlC,EAEAtJ,CAAC,CAACQ,CAAS,CAACY,SAAV,CAAsB,iBAAtB,CAAyCqC,CAAzC,CAAkD,KAAnD,CAAD,CAA0D4B,KAA1D,EACH,CAjbH,CAsbM1B,CAAe,CAAG,UAAM,CACxB3D,CAAC,CAACQ,CAAS,CAACgB,gBAAX,CAAD,CAA8B+B,WAA9B,CAA0C,QAA1C,EACAvD,CAAC,CAACQ,CAAS,CAACgB,gBAAX,CAAD,CAA8B8H,UAA9B,CAAyC,aAAzC,EACAtJ,CAAC,CAACQ,CAAS,CAACe,gBAAX,CAAD,CAA8BgC,WAA9B,CAA0C,QAA1C,EACAvD,CAAC,CAACQ,CAAS,CAACe,gBAAX,CAAD,CAA8B+H,UAA9B,CAAyC,aAAzC,EACAtJ,CAAC,CAACQ,CAAS,CAACc,SAAX,CAAD,CAAuBiC,WAAvB,CAAmC,QAAnC,EACAvD,CAAC,CAACQ,CAAS,CAACc,SAAX,CAAD,CAAuBgI,UAAvB,CAAkC,aAAlC,EACAtJ,CAAC,CAACQ,CAAS,CAACK,SAAX,CAAD,CAAuBwC,QAAvB,CAAgC,QAAhC,EACArD,CAAC,CAACQ,CAAS,CAACK,SAAX,CAAD,CAAuBwB,IAAvB,CAA4B,aAA5B,IACH,CA/bH,CAqcM8G,CAAqB,CAAG,UAAM,CAE9BnJ,CAAC,CAACQ,CAAS,CAACsB,yBAAX,CAAD,CAAuCsD,IAAvC,CAA4C,EAA5C,EAYA/E,CAAG,CAACgG,WAAJ,CAXiB,CACb,CACIC,GAAG,CAAE,WADT,CAEIC,SAAS,CAAE,gBAFf,CADa,CAKb,CACID,GAAG,CAAE,OADT,CAEIC,SAAS,CAAE,MAFf,CALa,CAWjB,EAA4BpB,IAA5B,CAAiC,SAASqB,CAAT,CAAsB,CACnD,GAAI+C,CAAAA,CAAW,CAAG,sJACwD/C,CAAW,CAAC,CAAD,CADnE,CACyE,kBADzE,CAElBA,CAAW,CAAC,CAAD,CAFO,CAED,QAFjB,CAGAxG,CAAC,CAACQ,CAAS,CAACsB,yBAAX,CAAD,CAAuCsD,IAAvC,CAA4CmE,CAA5C,CACH,CALD,CAMH,CAzdH,CA+dMC,CAAgB,CAAG,UAAM,IACrBC,CAAAA,CAAa,CAAGzJ,CAAC,CAACQ,CAAS,CAACkB,SAAV,CAAsB,WAAvB,CAAD,CAAqCqH,GAArC,EADK,CAErBW,CAAW,GAFU,CAGzB,GAA+D,CAA3D,GAAAD,CAAa,CAACE,OAAd,CAAsB,aAAtB,CAAqC,EAArC,EAAyCC,IAAzC,GAAgDpH,MAAhD,EAAgE,CAACiH,CAAa,CAACI,QAAd,CAAuB,MAAvB,CAArE,CAAqG,CACjGH,CAAW,GACd,CACD,GAA4D,EAAxD,EAAA1J,CAAC,CAACQ,CAAS,CAACkB,SAAV,CAAsB,uBAAvB,CAAD,CAA+CqH,GAA/C,IAA8DW,CAAlE,CAA+E,CAC3E1J,CAAC,CAACQ,CAAS,CAACkB,SAAV,CAAsB,GAAtB,CAA4BlB,CAAS,CAACS,WAAvC,CAAD,CAAqD6I,IAArD,CAA0D,UAA1D,IACH,CAFD,IAEO,CACH9J,CAAC,CAACQ,CAAS,CAACkB,SAAV,CAAsB,GAAtB,CAA4BlB,CAAS,CAACS,WAAvC,CAAD,CAAqD6I,IAArD,CAA0D,UAA1D,IACH,CACJ,CA1eH,CAofMC,CAAsB,CAAG,SAAU3H,CAAV,CAAgB8D,CAAhB,CAAwBC,CAAxB,CAAkCC,CAAlC,CAAkD,CAC3E,KAAKF,MAAL,CAAcA,CAAd,CACA,KAAKC,QAAL,CAAgBA,CAAhB,CACA,KAAKC,cAAL,CAAsBA,CAAtB,CACA,KAAKzD,MAAL,CAAc3C,CAAC,CAACQ,CAAS,CAACO,UAAX,CAAf,CACAf,CAAC,CAACQ,CAAS,CAACE,MAAX,CAAD,CAAoBsJ,EAApB,CAAuB,OAAvB,CAAgCxJ,CAAS,CAACQ,cAA1C,CAA0D,UAAY,CAClE0B,CAAY,EACf,CAFD,EAGAzC,CAAY,CAACF,MAAb,CAAoBqC,CAApB,CAA0B,CAACnC,CAAY,CAACgK,MAAb,CAAoBC,QAArB,CAA1B,EACA/J,CAAM,CAACgK,SAAP,CAAiBpI,CAAM,CAACC,IAAxB,CAA8B,UAAY,CACtCG,CAAI,CAACC,CAAD,CACP,CAFD,EAIAjC,CAAM,CAACgK,SAAP,CAAiBpI,CAAM,CAACE,IAAxB,CAA8B,UAAY,CACtCqG,CAAI,CAAClG,CAAD,CACP,CAFD,EAIAjC,CAAM,CAACgK,SAAP,CAAiBpI,CAAM,CAACG,iBAAxB,CAA2C,SAAUuG,CAAV,CAAoB,CAC3D,GAAIF,CAAS,CAACnG,CAAD,CAAb,CAAqB,CACjBkG,CAAI,CAAClG,CAAD,CAAJ,CACApC,CAAC,CAACQ,CAAS,CAACC,MAAX,CAAD,CAAoB4B,IAApB,CAAyB,UAAzB,CAAqC,CAAC,CAAtC,EAEA+H,CAAC,CAACC,GAAF,CAAM,+BAAN,CAAuC,UAAM,CACzCC,CAAC,CAACC,sBAAF,CAAyBC,IAAzB,CAA8B,CAACC,MAAM,CAAEjK,CAAS,CAACW,YAAnB,CAA9B,CACH,CAFD,EAGAiJ,CAAC,CAACC,GAAF,CAAM,+BAAN,CAAuC,UAAW,CAC9CC,CAAC,CAACC,sBAAF,CAAyBG,sBAAzB,EACH,CAFD,CAGH,CAVD,IAUO,CACHvI,CAAI,CAACC,CAAD,CAAJ,CACAoG,CAAW,CAACC,CAAD,CAAX,CACAzI,CAAC,CAACQ,CAAS,CAACC,MAAX,CAAD,CAAoB4B,IAApB,CAAyB,UAAzB,CAAqC,CAArC,CACH,CACJ,CAhBD,EAkBArC,CAAC,CAACQ,CAAS,CAACC,MAAX,CAAD,CAAoBuJ,EAApB,CAAuB,OAAvB,CAAgC,UAAY,CACxC,GAAIW,CAAAA,CAAU,CAAGvI,CAAI,CAACwI,IAAL,CAAUpK,CAAS,CAACM,YAApB,CAAjB,CACA,GAAI6J,CAAU,CAACnI,MAAf,CAAuB,CACnBmI,CAAU,CAACtF,KAAX,EACH,CAFD,IAEO,CACHrF,CAAC,CAACQ,CAAS,CAACG,gBAAX,CAAD,CAA8BiK,IAA9B,CAAmCpK,CAAS,CAACqK,WAA7C,EAA0DxF,KAA1D,EACH,CACJ,CAPD,EASArF,CAAC,CAACQ,CAAS,CAACE,MAAX,CAAD,CAAoB2E,KAApB,CAA0B,UAAY,CAClC,GAAIyF,CAAAA,CAAM,CAAG9K,CAAC,CAAC,IAAD,CAAD,CAAQqC,IAAR,CAAa,aAAb,CAAb,CACA,GAAIyI,CAAJ,CAAY,CACR9K,CAAC,CAAC,IAAM8K,CAAP,CAAD,CAAgBzF,KAAhB,EACH,CACJ,CALD,EAOA,GAAI0F,CAAAA,CAAW,CAAG3I,CAAI,CAACwI,IAAL,CAAUpK,CAAS,CAACM,YAApB,CAAlB,CACAiK,CAAW,CAACf,EAAZ,CAAe/J,CAAY,CAACgK,MAAb,CAAoBC,QAAnC,CAA6C,SAAUc,CAAV,CAAa9G,CAAb,CAAmB,CAC5DA,CAAI,CAAC+G,aAAL,CAAmBC,cAAnB,GACA,GAAIJ,CAAAA,CAAM,CAAG9K,CAAC,CAACQ,CAAS,CAACE,MAAX,CAAD,CAAoB2B,IAApB,CAAyB,aAAzB,CAAb,CACA,GAAIyI,CAAJ,CAAY,CACR9K,CAAC,CAAC,IAAM8K,CAAP,CAAD,CAAgBzF,KAAhB,EACH,CACDlF,CAAM,CAACgL,OAAP,CAAepJ,CAAM,CAACG,iBAAtB,CACH,CAPD,EAUAlC,CAAC,CAACQ,CAAS,CAACE,MAAX,CAAD,CAAoBsJ,EAApB,CAAuB,OAAvB,CAAgCxJ,CAAS,CAACa,YAA1C,CAAwD,UAAY,CAChEgI,CAAY,CAACrJ,CAAC,CAAC,IAAD,CAAD,CAAQkE,IAAR,CAAa,QAAb,CAAD,CACf,CAFD,EAIAlE,CAAC,CAACQ,CAAS,CAACE,MAAX,CAAD,CAAoBsJ,EAApB,CAAuB,OAAvB,CAAgCxJ,CAAS,CAACY,SAA1C,CAAqD,UAAY,CAC7DoC,CAAW,CAACxD,CAAC,CAAC,IAAD,CAAD,CAAQkE,IAAR,CAAa,QAAb,CAAD,CACd,CAFD,EAlE2E,GAuEvEkH,CAAAA,CAAY,CAAGlL,CAAM,CAACqC,aAAP,CAAqBvC,CAAC,CAAC,kCAAD,CAAtB,CAvEwD,CAwEvEqL,CAAc,CAAGrL,CAAC,CAAC,kCAAD,CAxEqD,CAyE3EqL,CAAc,CAACrB,EAAf,CAAkB,wBAAlB,CAA4C,UAAY,CACpD,GAAIsB,CAAAA,CAAO,CAAIC,KAAK,CAACC,OAAN,CAAgBD,KAAK,CAACC,OAAtB,CAAgCD,KAAK,CAACE,KAArD,CAEA,GAAe,IAAX,EAAAH,CAAO,EAAuB,IAAX,EAAAA,CAAnB,EAAoD,OAAd,EAAAC,KAAK,CAACG,IAAhD,CAAiE,CAC7D,GAAIxL,CAAM,CAACqI,SAAP,CAAiB6C,CAAjB,GAAkC7C,CAAS,CAACnG,CAAD,CAA/C,CAAuD,CACnDkG,CAAI,CAAClG,CAAD,CACP,CACJ,CACJ,CARD,EAUApC,CAAC,CAACQ,CAAS,CAACI,cAAX,CAAD,CAA4BoJ,EAA5B,CAA+B,QAA/B,CAAyC,MAAzC,CAAiDpB,CAAjD,EAGAY,CAAgB,GAChBxJ,CAAC,CAACQ,CAAS,CAACI,cAAV,CAA2B,4BAA5B,CAAD,CAAyDoJ,EAAzD,CAA4D,OAA5D,CAAqER,CAArE,EACAxJ,CAAC,CAACQ,CAAS,CAACI,cAAV,CAA2B,gBAA5B,CAAD,CAA+CoJ,EAA/C,CAAkD,QAAlD,CAA4DR,CAA5D,CACH,CA7kBH,CA4lBE,MAAO,CACHgB,IAAI,CANG,QAAPA,CAAAA,IAAO,CAAUpI,CAAV,CAAgB8D,CAAhB,CAAwBC,CAAxB,CAAkCC,CAAlC,CAAkD,CACzDhE,CAAI,CAAGpC,CAAC,CAACoC,CAAD,CAAR,CACA2H,CAAsB,CAAC3H,CAAD,CAAO8D,CAAP,CAAeC,CAAf,CAAyBC,CAAzB,CACzB,CAEM,CAGV,CAtnBC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Controls the notebook drawer.\n *\n * @module     local_notebook/notebook_drawer\n * @copyright  2022 Université de Montréal\n * @author     Issam Taboubi <issam.taboubi@umontreal.ca>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nrequire.config({\n    enforceDefine: true,\n    shim: {\n        'bootstrapTable': ['jquery'],\n        'bootstrapTableLocale': ['jquery', 'bootstrapTable'],\n        'bootstrapTableLocaleMobile': ['jquery', 'bootstrapTable']\n    },\n    paths: {\n        bootstrapTable: '/local/notebook/amd/build/bootstrap-table.min',\n        bootstrapTableLocale: '/local/notebook/amd/build/bootstrap-table-locale-all.min',\n        bootstrapTableLocaleMobile: '/local/notebook/amd/build/bootstrap-table-mobile.min'\n    }\n});\n\ndefine(\n    [\n        'jquery',\n        'core/custom_interaction_events',\n        'core/drawer',\n        'core/pubsub',\n        'core/notification',\n        'core/str',\n        'core/ajax',\n        'core/templates',\n        'bootstrapTable',\n        'bootstrapTableLocale',\n        'bootstrapTableLocaleMobile',\n    ],\n    function (\n        $,\n        CustomEvents,\n        Drawer,\n        PubSub,\n        notification,\n        str,\n        ajax,\n        Templates\n    ) {\n\n        var SELECTORS = {\n            JUMPTO: '.notebookbutton [data-region=\"jumpto\"]',\n            DRAWER: '[data-region=\"right-hand-notebook-drawer\"]',\n            HEADER_CONTAINER: '[data-region=\"header-container\"]',\n            BODY_CONTAINER: '[data-region=\"body-container\"]',\n            BODY_LIST: '[data-region=\"view-overview\"]',\n            CLOSE_BUTTON: '[data-action=\"closedrawer\"]',\n            NOTE_TABLE: '#notebook-table',\n            REFRESH_BUTTON: 'button[name=\"refresh\"]',\n            SAVE_BUTTON: '#savenote',\n            RESET_BUTTON: '#resetnote',\n            NOTE_FORM_ID: 'noteform',\n            VIEW_NOTE: '[data-region=\"body-container\"] #notebook-table .viewnote',\n            BACK_TO_LIST: '[data-region=\"header-container\"] .backtolist',\n            NOTE_VIEW: '[data-region=\"body-container\"] [data-region=\"view-note\"]',\n            FOOTER_NOTE_VIEW: '[data-region=\"footer-container\"] [data-region=\"view-note\"]',\n            HEADER_NOTE_VIEW: '[data-region=\"header-container\"] [data-region=\"view-note\"]',\n            HEADER_NOTE_DATE: '[data-region=\"header-container\"] .notedate',\n            NOTE_FORM: '[data-region=\"body-container\"] #noteform',\n            FOOTER_NOTE_DELETE: '[data-region=\"footer-container\"] .deletenote',\n            FOOTER_NOTE_EDIT: '[data-region=\"footer-container\"] .editnote',\n            FOOTER_NOTE_TAGS: '[data-region=\"footer-container\"] .notetags',\n            MESSAGE_SUCCESS_CONTAINER: '[data-region=\"body-container\"] #fgroup_id_buttonar .col-form-label .form-label-addon'\n        };\n        var Events = {\n            SHOW: 'notebook-drawer-show',\n            HIDE: 'notebook-drawer-hide',\n            TOGGLE_VISIBILITY: 'notebook-drawer-toggle',\n        };\n\n\n        /**\n         * Show the Notebook drawer.\n         *\n         * @param {Object} root The notebook drawer container.\n         */\n        var show = function (root) {\n            if (!root.attr('data-shown')) {\n                root.attr('data-shown', true);\n            }\n\n            var drawerRoot = getDrawerRoot(root);\n            if (drawerRoot.length) {\n                Drawer.show(drawerRoot);\n                // Here load list.\n                displayNotes();\n            }\n        };\n\n        /**\n         * Refresh notes.\n         *\n         */\n        var refreshNotes = function () {\n            this.$table.bootstrapTable('destroy');\n            displayNotes();\n        };\n\n        /**\n         * Get formatted tags.\n         *\n         * @param {Array.<Object>} tags\n         * @return {String} return tags html\n         */\n        var getFormattedTags = function(tags) {\n            var tagshtml = '';\n\n            tags.forEach(function(item) {\n                tagshtml += '<span class=\"badge badge-info text-truncate context-note\">'\n                    + '<a title=\"' + item.title + '\" href=\"' + item.url + '\">' + item.title + '</a></span>';\n            });\n\n            return tagshtml;\n        };\n\n        /**\n         * Add blur note content.\n         *\n         */\n        var addBlurContent = function () {\n            let selectors = SELECTORS.FOOTER_NOTE_VIEW + ', ' + SELECTORS.HEADER_NOTE_DATE + ', ' + SELECTORS.NOTE_VIEW;\n            $(selectors).addClass('blur-content');\n        };\n\n        /**\n         * Remove blur note content.\n         *\n         */\n        var removeBlurContent = function () {\n            let selectors = SELECTORS.FOOTER_NOTE_VIEW + ', ' + SELECTORS.HEADER_NOTE_DATE + ', ' + SELECTORS.NOTE_VIEW;\n            $(selectors).removeClass('blur-content');\n        };\n\n        /**\n         * Display note.\n         *\n         * @param {String} noteid The note id\n         */\n        var displayNote = function (noteid) {\n            var promises = [];\n            displayNoteView();\n            addBlurContent();\n\n            promises = ajax.call([{\n                methodname: 'local_notebook_read_note',\n                args: {\n                    noteid: noteid\n                }\n            },\n            {\n                methodname: 'local_notebook_note_viewed',\n                args: {\n                    id: noteid\n                }\n            }]);\n            promises[0].done(function (result) {\n                let data = {};\n                data.subject = result.subject;\n                data.summary = result.summary;\n                let timestamp = result.created * 1000;\n                let datecreation = new Date(timestamp).toLocaleDateString(document.documentElement.lang, {\n                    day : 'numeric',\n                    month : 'short',\n                    year : 'numeric'\n                });\n                let timecreation = new Date(timestamp).toLocaleTimeString(document.documentElement.lang);\n                Templates.render('local_notebook/note_content', data)\n                .then(function(html) {\n                    // Display content.\n                    $(SELECTORS.NOTE_VIEW).html(html);\n                    // Display date.\n                    $(SELECTORS.HEADER_NOTE_DATE).html(datecreation + ' ' + timecreation);\n                    // Set buttons.\n                    $(SELECTORS.FOOTER_NOTE_DELETE).data('noteid', result.id);\n                    $(SELECTORS.FOOTER_NOTE_EDIT).data('noteid', result.id);\n                    // Set tags.\n                    $(SELECTORS.FOOTER_NOTE_TAGS).html(getFormattedTags(result.tags));\n                    // Remove blur content.\n                    removeBlurContent();\n                    // Set focus on button back to list.\n                    $(SELECTORS.BACK_TO_LIST).data('noteid', result.id);\n                    $(SELECTORS.BACK_TO_LIST).focus();\n                    // Log viewed event.\n                    promises[1].done(function () {}).fail(Notification.exception);\n                    return;\n                })\n                .fail(Notification.exception);\n            }).fail(Notification.exception);\n        };\n\n        /**\n         * Resize editor.\n         *\n         */\n        var resizeEditor = function () {\n            let heightcontainer = $(SELECTORS.BODY_CONTAINER).outerHeight(true);\n            let heightlistnote = $(SELECTORS.BODY_CONTAINER + \" #list-note-container\").outerHeight(true);\n            let heightsubject = $(SELECTORS.BODY_CONTAINER + \" #fitem_id_subject\").outerHeight(true);\n            let heightbutton = $(SELECTORS.BODY_CONTAINER + \" [data-region='footer']\").outerHeight(true);\n            let heighttoolbareditor = $(SELECTORS.BODY_CONTAINER + \" [role='toolbar']\").outerHeight(true);\n            let margin = 40;\n            let heighteditor = heightcontainer - heightlistnote - heightsubject - heightbutton - heighttoolbareditor - margin;\n            if (heighteditor < 100) {\n                heighteditor = 100;\n            }\n\n            $(SELECTORS.BODY_CONTAINER+ \" #id_noteeditable\").css( {\n                \"min-height\" : heighteditor + \"px\",\n                \"height\" : heighteditor + \"px\",\n            });\n        };\n\n        /**\n         * Display notes.\n         *\n         */\n        var displayNotes = function () {\n            var promises = [];\n\n            promises = ajax.call([{\n                methodname: 'local_notebook_notes_list',\n                args: {\n                    userid: this.userid,\n                    courseid: this.courseid,\n                    coursemoduleid: this.coursemoduleid\n                }\n            }]);\n            var stringkeys = [\n                {\n                    key: 'notetitle',\n                    component: 'local_notebook'\n                },\n                {\n                    key: 'notecontext',\n                    component: 'local_notebook',\n                },\n                {\n                    key: 'notedate',\n                    component: 'local_notebook',\n                },\n                {\n                    key: 'displaynote',\n                    component: 'local_notebook',\n                }\n            ];\n\n            str.get_strings(stringkeys).then(function(langStrings) {\n                let box = document.querySelector('[data-region=\"right-hand-notebook-drawer\"]');\n                let height = box.offsetHeight;\n                let tableheight = 460;\n                if (height < 800) {\n                    tableheight = 300;\n                } else if (height < 600) {\n                    tableheight = 250;\n                }\n\n                let data = [];\n                promises[0].done(function (result) {\n                    $.each(result, function (index, value) {\n                        let subject = {};\n                        subject.text = value.subject;\n                        subject.tags = value.tags;\n                        data.push({\n                            'id': value.id,\n                            'subject': subject,\n                            'contextname': value.contextname,\n                            'created': value.created\n                        });\n                    });\n                    this.$table.bootstrapTable({\n                        locale: document.documentElement.lang,\n                        paginationParts: ['pageInfo', 'pageList'],\n                        paginationSuccessivelySize: 2,\n                        paginationPagesBySide: 1,\n                        data: data,\n                        height: tableheight,\n                        columns: [\n                            [{\n                                field: 'state',\n                                checkbox: true\n                            },\n                            {\n                                field: 'subject',\n                                title: langStrings[0],\n                                sortable: true,\n                                width: 300,\n                                formatter: subjectFormatter,\n                            },\n                            {\n                                field: 'contextname',\n                                title: langStrings[1],\n                                sortable: true\n                            },\n                            {\n                                field: 'created',\n                                title: langStrings[2],\n                                sortable: true,\n                                formatter: dateFormatter,\n                                width: 110\n                            },\n                            {\n                                field: 'operate',\n                                title: '',\n                                align: 'center',\n                                formatter: operateFormatter\n                            }]\n                        ],\n                        onPostBody: function() {\n                            // Resize editor to the wright height.\n                            resizeEditor();\n                        }\n                    });\n\n                    /**\n                     * Format date.\n                     *\n                     * @param {String} value\n                     * @return {String}\n                     */\n                    function dateFormatter(value) {\n                        var today = new Date(value * 1000).toLocaleDateString(document.documentElement.lang, {\n                            day : 'numeric',\n                            month : 'short',\n                            year : 'numeric'\n                        });\n                        return today;\n                    }\n\n                    /**\n                     * Format subject.\n                     *\n                     * @param {String} value\n                     * @return {String}\n                     */\n                    function subjectFormatter(value) {\n                        let nbtags = value.tags.length;\n                        var td = \"<span class='text-truncate subject'>\" + value.text + \"</span><br>\";\n                        var nbclass = nbtags === 1 ? 'wcn-1' : 'wcn-2';\n                        value.tags.forEach(function(item) {\n                            td += '<span class=\"badge badge-info text-truncate context-note ' + nbclass\n                                + '\"><a title=\"' + item.title + '\" href=\"' + item.url + '\">' + item.title + '</a></span>';\n                        });\n                        return td;\n                    }\n\n                    /**\n                     * Display note button.\n                     *\n                     * @param {String} value\n                     * @param {Object} row\n                     */\n                    function operateFormatter(value, row) {\n                        return [\n                            '<a class=\"viewnote\" data-noteid=\"' + row.id + '\" href=\"#\" title=\"' + langStrings[3] + '\">',\n                            '<i class=\"fa fa-chevron-right\" aria-hidden=\"true\"></i>',\n                            '</a>'\n                        ].join('');\n                    }\n\n                }).fail(notification.exception);\n            }).fail(Notification.exception);\n\n        };\n\n        /**\n         * Hide the notebook drawer.\n         *\n         * @param {Object} root The notebook drawer container.\n         */\n        var hide = function (root) {\n            var drawerRoot = getDrawerRoot(root);\n            if (drawerRoot.length) {\n                Drawer.hide(drawerRoot);\n            }\n        };\n\n        /**\n         * Check if the drawer is visible.\n         *\n         * @param {Object} root The notebook drawer container.\n         * @return {boolean}\n         */\n        var isVisible = function (root) {\n            var drawerRoot = getDrawerRoot(root);\n            if (drawerRoot.length) {\n                return Drawer.isVisible(drawerRoot);\n            }\n            return true;\n        };\n\n        /**\n         * Set Jump from button\n         *\n         * @param {String} buttonid The originating button id\n         */\n        var setJumpFrom = function (buttonid) {\n            $(SELECTORS.DRAWER).attr('data-origin', buttonid);\n        };\n\n        /**\n         * Find the root element of the drawer based on the using the drawer content root's ID.\n         *\n         * @param {Object} contentRoot The drawer content's root element.\n         * @returns {*|jQuery}\n         */\n        var getDrawerRoot = (contentRoot) => {\n            contentRoot = $(contentRoot);\n            return contentRoot.closest('[data-region=\"right-hand-notebook-drawer\"]');\n        };\n\n        /**\n         * Submit form ajax.\n         *\n         */\n        var submitFormAjax = () => {\n            if ($(document.activeElement).data('action') == 'reset') {\n                resetNoteForm();\n            } else {\n                let args = {};\n                args.userid = this.userid;\n                args.courseid = this.courseid;\n                args.coursemoduleid = this.coursemoduleid;\n                args.subject = $(SELECTORS.NOTE_FORM +' input[name=\"subject\"]').val();\n                args.note = $(SELECTORS.NOTE_FORM).serialize();\n                ajax.call([{\n                    methodname: 'local_notebook_add_note',\n                    args: args,\n                    done: function(result) {\n                        if (!result.error) {\n                            // Display success message.\n                            displayMessageSuccess();\n                            // Refresh list.\n                            refreshNotes();\n                        }\n                    },\n                    fail: notification.exception\n                }]);\n            }\n            return false;\n        };\n\n        /**\n         * Reset form.\n         *\n         */\n        var resetNoteForm = () => {\n            $(SELECTORS.NOTE_FORM +' input[name=\"subject\"]').val($(SELECTORS.NOTE_FORM +' input[name=\"subjectorigin\"]').val());\n            $(SELECTORS.NOTE_FORM + ' textarea').val('');\n            $(SELECTORS.BODY_CONTAINER+ \" #id_noteeditable\").html('');\n            $(SELECTORS.NOTE_FORM + ' textarea').trigger('change');\n            // Remove message success if exist.\n            $(SELECTORS.MESSAGE_SUCCESS_CONTAINER).html('');\n\n        };\n\n        /**\n         * Hide note view.\n         *\n         * @param {String} noteid\n         */\n        var hideNoteView = (noteid) => {\n            $(SELECTORS.HEADER_NOTE_VIEW).addClass('hidden');\n            $(SELECTORS.HEADER_NOTE_VIEW).attr('aria-hidden', true);\n            $(SELECTORS.FOOTER_NOTE_VIEW).addClass('hidden');\n            $(SELECTORS.FOOTER_NOTE_VIEW).attr('aria-hidden', true);\n            $(SELECTORS.NOTE_VIEW).addClass('hidden');\n            $(SELECTORS.NOTE_VIEW).attr('aria-hidden', true);\n            $(SELECTORS.BODY_LIST).removeClass('hidden');\n            $(SELECTORS.BODY_LIST).removeAttr('aria-hidden');\n            // Set focus back to last item clicked.\n            $(SELECTORS.VIEW_NOTE + '[data-noteid=\"' + noteid + '\"]').focus();\n        };\n\n        /**\n         * Hide note view.\n         */\n        var displayNoteView = () => {\n            $(SELECTORS.HEADER_NOTE_VIEW).removeClass('hidden');\n            $(SELECTORS.HEADER_NOTE_VIEW).removeAttr('aria-hidden');\n            $(SELECTORS.FOOTER_NOTE_VIEW).removeClass('hidden');\n            $(SELECTORS.FOOTER_NOTE_VIEW).removeAttr('aria-hidden');\n            $(SELECTORS.NOTE_VIEW).removeClass('hidden');\n            $(SELECTORS.NOTE_VIEW).removeAttr('aria-hidden');\n            $(SELECTORS.BODY_LIST).addClass('hidden');\n            $(SELECTORS.BODY_LIST).attr('aria-hidden', true);\n        };\n\n        /**\n         * Display message success.\n         *\n         */\n        var displayMessageSuccess = () => {\n            // Remove old message.\n            $(SELECTORS.MESSAGE_SUCCESS_CONTAINER).html('');\n            var stringkeys = [\n                {\n                    key: 'notesaved',\n                    component: 'local_notebook'\n                },\n                {\n                    key: 'close',\n                    component: 'core'\n                }\n            ];\n\n            str.get_strings(stringkeys).then(function(langStrings) {\n                let messageHtml = '<div class=\"alert alert-success alert-block fade in \" role=\"alert\">' +\n                '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"' + langStrings[1] + '\">×</button>' +\n                langStrings[0] + '</div>';\n                $(SELECTORS.MESSAGE_SUCCESS_CONTAINER).html(messageHtml);\n            });\n        };\n\n        /**\n         * Toggle save button.\n         *\n         */\n        var toggleSaveButton = () => {\n            let editorcontent = $(SELECTORS.NOTE_FORM + ' textarea').val();\n            let emptyeditor = false;\n            if (editorcontent.replace(/<(.|\\n)*?>/g, '').trim().length === 0 && !editorcontent.includes(\"<img\")) {\n                emptyeditor = true;\n            }\n            if ($(SELECTORS.NOTE_FORM + ' input[type=\"text\"]').val() == '' || emptyeditor) {\n                $(SELECTORS.NOTE_FORM + ' ' + SELECTORS.SAVE_BUTTON).prop('disabled', true);\n            } else {\n                $(SELECTORS.NOTE_FORM + ' ' + SELECTORS.SAVE_BUTTON).prop('disabled', false);\n            }\n        };\n\n        /**\n         * Listen to showing and hiding the notebook drawer.\n         *\n         * @param {Object} root The notebook drawer container.\n         * @param {String} userid The user ID\n         * @param {String} courseid The course ID\n         * @param {String} coursemoduleid The cours module ID\n         */\n        var registerEventListeners = function (root, userid, courseid, coursemoduleid) {\n            this.userid = userid;\n            this.courseid = courseid;\n            this.coursemoduleid = coursemoduleid;\n            this.$table = $(SELECTORS.NOTE_TABLE);\n            $(SELECTORS.DRAWER).on('click', SELECTORS.REFRESH_BUTTON, function () {\n                refreshNotes();\n            });\n            CustomEvents.define(root, [CustomEvents.events.activate]);\n            PubSub.subscribe(Events.SHOW, function () {\n                show(root);\n            });\n\n            PubSub.subscribe(Events.HIDE, function () {\n                hide(root);\n            });\n\n            PubSub.subscribe(Events.TOGGLE_VISIBILITY, function (buttonid) {\n                if (isVisible(root)) {\n                    hide(root);\n                    $(SELECTORS.JUMPTO).attr('tabindex', -1);\n                    // Load formchangechecker module.\n                    Y.use('moodle-core-formchangechecker', () => {\n                        M.core_formchangechecker.init({formid: SELECTORS.NOTE_FORM_ID});\n                    });\n                    Y.use('moodle-core-formchangechecker', function() {\n                        M.core_formchangechecker.reset_form_dirty_state();\n                    });\n                } else {\n                    show(root);\n                    setJumpFrom(buttonid);\n                    $(SELECTORS.JUMPTO).attr('tabindex', 0);\n                }\n            });\n\n            $(SELECTORS.JUMPTO).on('focus', function () {\n                var firstInput = root.find(SELECTORS.CLOSE_BUTTON);\n                if (firstInput.length) {\n                    firstInput.focus();\n                } else {\n                    $(SELECTORS.HEADER_CONTAINER).find(SELECTORS.ROUTES_BACK).focus();\n                }\n            });\n\n            $(SELECTORS.DRAWER).focus(function () {\n                var button = $(this).attr('data-origin');\n                if (button) {\n                    $('#' + button).focus();\n                }\n            });\n\n            var closebutton = root.find(SELECTORS.CLOSE_BUTTON);\n            closebutton.on(CustomEvents.events.activate, function (e, data) {\n                data.originalEvent.preventDefault();\n                var button = $(SELECTORS.DRAWER).attr('data-origin');\n                if (button) {\n                    $('#' + button).focus();\n                }\n                PubSub.publish(Events.TOGGLE_VISIBILITY);\n            });\n\n            // Back to list.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.BACK_TO_LIST, function () {\n                hideNoteView($(this).data('noteid'));\n            });\n            // View note.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.VIEW_NOTE, function () {\n                displayNote($(this).data('noteid'));\n            });\n\n            // If notebook drawer is visible and we open message drawer, hide notebook.\n            var msdrawerRoot = Drawer.getDrawerRoot($('[data-region=\"message-drawer\"]'));\n            var messagetoggler = $('[id^=\"message-drawer-toggle-\"]');\n            messagetoggler.on('click keydown keypress', function () {\n                var keycode = (event.keyCode ? event.keyCode : event.which);\n                // Enter, space or click.\n                if (keycode == '13' || keycode == '32' || event.type == 'click') {\n                    if (Drawer.isVisible(msdrawerRoot) && isVisible(root)) {\n                        hide(root);\n                    }\n                }\n            });\n\n            $(SELECTORS.BODY_CONTAINER).on('submit', 'form', submitFormAjax);\n\n            // Enable/disbled save button.\n            toggleSaveButton();\n            $(SELECTORS.BODY_CONTAINER + ' form input[type=\"text\"]').on('input', toggleSaveButton);\n            $(SELECTORS.BODY_CONTAINER + ' form textarea').on('change', toggleSaveButton);\n        };\n\n        /**\n         * Initialise the notebook drawer.\n         *\n         * @param {Object} root The notebook drawer container.\n         * @param {String} userid The user ID\n         * @param {String} courseid The course ID\n         * @param {String} coursemoduleid The cours module ID\n         */\n        var init = function (root, userid, courseid, coursemoduleid) {\n            root = $(root);\n            registerEventListeners(root, userid, courseid, coursemoduleid);\n        };\n\n        return {\n            init: init,\n        };\n    });\n"],"file":"notebook_drawer.min.js"}