{"version":3,"sources":["../src/notebook_drawer.js"],"names":["require","config","enforceDefine","shim","paths","bootstrapTable","bootstrapTableLocale","bootstrapTableLocaleMobile","define","$","CustomEvents","Drawer","PubSub","notification","str","ajax","Templates","SELECTORS","JUMPTO","DRAWER","HEADER_CONTAINER","BODY_CONTAINER","BODY_LIST","CLOSE_BUTTON","NOTE_TABLE","REFRESH_BUTTON","ADD_BUTTON_TO_CLONE","SAVE_BUTTON","CANCEL_BUTTON","NOTE_FORM_ID","VIEW_NOTE","BACK_TO_LIST","NOTE_VIEW","FOOTER_NOTE_VIEW","HEADER_NOTE_VIEW","HEADER_NOTE_CREATED_DATE","HEADER_NOTE_LAST_MODIFIED_DATE","NOTE_FORM_CONTAINER","NOTE_LIST_CONTAINER","NOTE_TABLE_CONTAINER","NOTE_TABLE_ROW","NOTE_FORM","HEADER_NOTE_DELETE","HEADER_NOTE_EDIT","FOOTER_NOTE_TAGS","MESSAGE_SUCCESS_CONTAINER","DIALOGUE_CONTAINER","CONFIRM_TEXT_MULTI","CONFIRM_TEXT_SINGLE","CONFIRM_DELETE_BUTTON_MULTI","CONFIRM_DELETE_BUTTON_SINGLE","CANCEL_DELETE_BUTTON_MULTI","CANCEL_DELETE_BUTTON_SINGLE","DELETE_NOTE_BUTTON","CHECKBOX_LIST_NOTE","CHECKBOX_ALL_NOTE","TABLE_DELETE_BUTTON","NOTE_LIST_ACTIONS","SELECTED_NOTE_COUNT","CLOSE_NOTE_LIST_ACTIONS","TABLE_PAGINATION","SEEALL_CONTAINER","Events","SHOW","HIDE","TOGGLE_VISIBILITY","show","root","attr","drawerRoot","getDrawerRoot","length","displayNotes","refreshNotes","$table","getFormattedTags","tags","tagshtml","forEach","item","title","url","addBlurContent","selectors","addClass","removeBlurContent","removeClass","displayNote","noteid","promises","displayNoteView","call","methodname","args","id","done","result","data","subject","summary","createdtimestamp","created","datecreation","Date","toLocaleDateString","document","documentElement","lang","day","month","year","timecreation","toLocaleTimeString","lastmodifiedtimestamp","lastmodified","lastmodifieddate","lastmodifiedtime","render","then","html","focus","fail","Notification","exception","userid","courseid","coursemoduleid","get_strings","key","component","langStrings","tablecontainer","querySelector","tableheight","offsetHeight","each","index","value","text","push","contextname","locale","paginationParts","paginationSuccessivelySize","paginationPagesBySide","height","columns","field","checkbox","visible","sortable","sortName","width","formatter","nbtags","td","nbclass","today","titleTooltip","align","row","join","onPostBody","displayAddNoteButton","find","addnotebtn","clone","window","console","log","append","on","resetNoteForm","toggleNoteForm","closeConfirmDialogue","action","showConfirmDialogue","toshow","tohide","list","val","hide","isVisible","setJumpFrom","buttonid","contentRoot","closest","submitFormAjax","activeElement","update","service","note","serialize","displayMessageSuccess","submitDeleteAjax","notesids","keymessage","notes","hideNoteView","toggleNoteListFooter","trigger","removeAttr","editNoteView","toggleSaveButton","messageHtml","setTimeout","fadeOut","editorcontent","emptyeditor","samecontent","subjectform","subjectorigin","summaryorigin","localeCompare","replace","trim","includes","prop","toggleNoteListActions","selectednotecount","arialabel","empty","registerEventListeners","events","activate","subscribe","Y","use","M","core_formchangechecker","init","formid","reset_form_dirty_state","firstInput","ROUTES_BACK","button","closebutton","e","originalEvent","preventDefault","publish","target","hasClass","parent","is","msdrawerRoot","messagetoggler","keycode","event","keyCode","which","type"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Controls the notebook drawer.\n *\n * @module     local_notebook/notebook_drawer\n * @copyright  2022 Université de Montréal\n * @author     Issam Taboubi <issam.taboubi@umontreal.ca>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nrequire.config({\n    enforceDefine: true,\n    shim: {\n        'bootstrapTable': ['jquery'],\n        'bootstrapTableLocale': ['jquery', 'bootstrapTable'],\n        'bootstrapTableLocaleMobile': ['jquery', 'bootstrapTable']\n    },\n    paths: {\n        bootstrapTable: '/local/notebook/amd/build/bootstrap-table.min',\n        bootstrapTableLocale: '/local/notebook/amd/build/bootstrap-table-locale-all.min',\n        bootstrapTableLocaleMobile: '/local/notebook/amd/build/bootstrap-table-mobile.min'\n    }\n});\n\ndefine(\n    [\n        'jquery',\n        'core/custom_interaction_events',\n        'core/drawer',\n        'core/pubsub',\n        'core/notification',\n        'core/str',\n        'core/ajax',\n        'core/templates',\n        'bootstrapTable',\n        'bootstrapTableLocale',\n        'bootstrapTableLocaleMobile',\n    ], function(\n        $,\n        CustomEvents,\n        Drawer,\n        PubSub,\n        notification,\n        str,\n        ajax,\n        Templates\n    ) {\n\n        var SELECTORS = {\n            JUMPTO: '.notebookbutton [data-region=\"jumpto\"]',\n            DRAWER: '[data-region=\"right-hand-notebook-drawer\"]',\n            HEADER_CONTAINER: '[data-region=\"header-container\"]',\n            BODY_CONTAINER: '[data-region=\"body-container\"]',\n            BODY_LIST: '[data-region=\"view-overview\"]',\n            CLOSE_BUTTON: '[data-action=\"closedrawer\"]',\n            NOTE_TABLE: '#notebook-table',\n            REFRESH_BUTTON: 'button[name=\"refresh\"]',\n            ADD_BUTTON_TO_CLONE: '#notebook-table-container .addnote',\n            SAVE_BUTTON: '#savenote',\n            CANCEL_BUTTON: '#cancel-add-edit',\n            NOTE_FORM_ID: 'noteform',\n            VIEW_NOTE: '[data-region=\"body-container\"] #notebook-table .viewnote',\n            BACK_TO_LIST: '[data-region=\"header-container\"] .backtolist',\n            NOTE_VIEW: '[data-region=\"body-container\"] [data-region=\"view-note\"]',\n            FOOTER_NOTE_VIEW: '[data-region=\"footer-container\"] [data-region=\"view-note\"]',\n            HEADER_NOTE_VIEW: '[data-region=\"header-container\"] [data-region=\"view-note\"]',\n            HEADER_NOTE_CREATED_DATE: '[data-region=\"header-container\"] .notecreateddate',\n            HEADER_NOTE_LAST_MODIFIED_DATE: '[data-region=\"header-container\"] .notelastmodifieddate',\n            NOTE_FORM_CONTAINER: '[data-region=\"body-container\"] #add-note-form-container',\n            NOTE_LIST_CONTAINER: '[data-region=\"body-container\"] #list-note-container',\n            NOTE_TABLE_CONTAINER: '[data-region=\"body-container\"] #notebook-table-container',\n            NOTE_TABLE_ROW: '[data-region=\"body-container\"] #notebook-table tr',\n            NOTE_FORM: '[data-region=\"body-container\"] #noteform',\n            HEADER_NOTE_DELETE: '[data-region=\"header-container\"] .deletenote',\n            HEADER_NOTE_EDIT: '[data-region=\"header-container\"] .editnote',\n            FOOTER_NOTE_TAGS: '[data-region=\"footer-container\"] .notetags',\n            MESSAGE_SUCCESS_CONTAINER: '#message-success-container',\n            DIALOGUE_CONTAINER: '[data-region=\"right-hand-notebook-drawer\"] [data-region=\"confirm-dialogue-container\"]',\n            CONFIRM_TEXT_MULTI: '[data-region=\"right-hand-notebook-drawer\"] [data-region=\"confirm-dialogue-container\"] ' +\n                '.multiplenotes',\n            CONFIRM_TEXT_SINGLE: '[data-region=\"right-hand-notebook-drawer\"] [data-region=\"confirm-dialogue-container\"] ' +\n                '.singlenote',\n            CONFIRM_DELETE_BUTTON_MULTI: '[data-region=\"confirm-dialogue-container\"] [data-action=\"confirm-delete-multiple\"]',\n            CONFIRM_DELETE_BUTTON_SINGLE: '[data-region=\"confirm-dialogue-container\"] [data-action=\"confirm-delete-single\"]',\n            CANCEL_DELETE_BUTTON_MULTI: '[data-region=\"confirm-dialogue-container\"] [data-action=\"cancel-delete-multiple\"]',\n            CANCEL_DELETE_BUTTON_SINGLE: '[data-region=\"confirm-dialogue-container\"] [data-action=\"cancel-delete-single\"]',\n            DELETE_NOTE_BUTTON: '.deletenote',\n            CHECKBOX_LIST_NOTE: '[name=\"btSelectItem\"]',\n            CHECKBOX_ALL_NOTE: '[name=\"btSelectAll\"]',\n            TABLE_DELETE_BUTTON: '#delete-selected-notes',\n            NOTE_LIST_ACTIONS: '#note-list-actions',\n            SELECTED_NOTE_COUNT: '#note-list-actions .selected-note-count',\n            CLOSE_NOTE_LIST_ACTIONS: '#note-list-actions .close',\n            TABLE_PAGINATION: '[data-region=\"right-hand-notebook-drawer\"] .fixed-table-pagination',\n            SEEALL_CONTAINER: '[data-region=\"footer-container\"] [data-region=\"view-overview\"]'\n        };\n        var Events = {\n            SHOW: 'notebook-drawer-show',\n            HIDE: 'notebook-drawer-hide',\n            TOGGLE_VISIBILITY: 'notebook-drawer-toggle',\n        };\n\n\n        /**\n         * Show the Notebook drawer.\n         *\n         * @param {Object} root The notebook drawer container.\n         */\n        var show = (root) => {\n            if (!root.attr('data-shown')) {\n                root.attr('data-shown', true);\n            }\n\n            var drawerRoot = getDrawerRoot(root);\n            if (drawerRoot.length) {\n                Drawer.show(drawerRoot);\n                // Here load list.\n                displayNotes();\n            }\n        };\n\n        /**\n         * Refresh notes.\n         *\n         */\n        var refreshNotes = () => {\n            this.$table.bootstrapTable('destroy');\n            displayNotes();\n        };\n\n        /**\n         * Get formatted tags.\n         *\n         * @param {Array.<Object>} tags\n         * @return {String} return tags html\n         */\n        var getFormattedTags = (tags) => {\n            var tagshtml = '';\n\n            tags.forEach(function(item) {\n                tagshtml += '<span class=\"badge badge-info text-truncate context-note\">'\n                    + '<a title=\"' + item.title + '\" href=\"' + item.url + '\">' + item.title + '</a></span>';\n            });\n\n            return tagshtml;\n        };\n\n        /**\n         * Add blur note content.\n         *\n         */\n        var addBlurContent = () => {\n            let selectors = SELECTORS.FOOTER_NOTE_VIEW + ', ' + SELECTORS.HEADER_NOTE_CREATED_DATE + ', ' +\n                SELECTORS.HEADER_NOTE_LAST_MODIFIED_DATE + ', '+ SELECTORS.NOTE_VIEW;\n            $(selectors).addClass('blur-content');\n        };\n\n        /**\n         * Remove blur note content.\n         *\n         */\n        var removeBlurContent = () => {\n            let selectors = SELECTORS.FOOTER_NOTE_VIEW + ', ' + SELECTORS.HEADER_NOTE_CREATED_DATE + ', ' +\n                SELECTORS.HEADER_NOTE_LAST_MODIFIED_DATE + ', '+ SELECTORS.NOTE_VIEW;\n            $(selectors).removeClass('blur-content');\n        };\n\n        /**\n         * Display note.\n         *\n         * @param {String} noteid The note id\n         */\n        var displayNote = (noteid) => {\n            var promises = [];\n            displayNoteView();\n            addBlurContent();\n\n            promises = ajax.call([{\n                methodname: 'local_notebook_read_note',\n                args: {\n                    noteid: noteid\n                }\n            },\n            {\n                methodname: 'local_notebook_note_viewed',\n                args: {\n                    id: noteid\n                }\n            }]);\n            promises[0].done(function (result) {\n                let data = {};\n                data.subject = result.subject;\n                data.summary = result.summary;\n\n                // Note created datetime.\n                let createdtimestamp = result.created * 1000;\n                let datecreation = new Date(createdtimestamp).toLocaleDateString(document.documentElement.lang, {\n                    day : 'numeric',\n                    month : 'short',\n                    year : 'numeric'\n                });\n                let timecreation = new Date(createdtimestamp).toLocaleTimeString(document.documentElement.lang);\n\n                // Note last modified datetime.\n                let lastmodifiedtimestamp = result.lastmodified * 1000;\n                let lastmodifieddate = new Date(lastmodifiedtimestamp).toLocaleDateString(document.documentElement.lang, {\n                    day : 'numeric',\n                    month : 'short',\n                    year : 'numeric'\n                });\n                let lastmodifiedtime = new Date(lastmodifiedtimestamp).toLocaleTimeString(document.documentElement.lang);\n\n                Templates.render('local_notebook/note_content', data)\n                .then(function(html) {\n                    // Display content.\n                    $(SELECTORS.NOTE_VIEW).html(html);\n                    // Display dates.\n                    $(SELECTORS.HEADER_NOTE_CREATED_DATE).html(datecreation + ' ' + timecreation);\n                    $(SELECTORS.HEADER_NOTE_LAST_MODIFIED_DATE).html(lastmodifieddate + ' ' + lastmodifiedtime);\n                    // Set buttons.\n                    $(SELECTORS.HEADER_NOTE_DELETE).data('noteid', result.id);\n                    $(SELECTORS.HEADER_NOTE_EDIT).data('noteid', result.id);\n                    // Set tags.\n                    $(SELECTORS.FOOTER_NOTE_TAGS).html(getFormattedTags(result.tags));\n                    // Remove blur content.\n                    removeBlurContent();\n                    // Set focus on button back to list.\n                    $(SELECTORS.BACK_TO_LIST).data('noteid', result.id);\n                    $(SELECTORS.BACK_TO_LIST).focus();\n                    // Log viewed event.\n                    promises[1].done(function () {}).fail(Notification.exception);\n                    return;\n                })\n                .fail(Notification.exception);\n            }).fail(Notification.exception);\n        };\n\n        /**\n         * Display notes.\n         *\n         */\n        var displayNotes = () => {\n            var promises = [];\n\n            promises = ajax.call([{\n                methodname: 'local_notebook_notes_list',\n                args: {\n                    userid: this.userid,\n                    courseid: this.courseid,\n                    coursemoduleid: this.coursemoduleid\n                }\n            }]);\n            var stringkeys = [\n                {\n                    key: 'notetitle',\n                    component: 'local_notebook'\n                },\n                {\n                    key: 'notecontext',\n                    component: 'local_notebook',\n                },\n                {\n                    key: 'notedate',\n                    component: 'local_notebook',\n                },\n                {\n                    key: 'displaynote',\n                    component: 'local_notebook',\n                },\n                {\n                    key: 'lastmodifieddate',\n                    component: 'local_notebook',\n                }\n            ];\n\n            str.get_strings(stringkeys).then(function(langStrings) {\n                let tablecontainer = document.querySelector('#list-note-container');\n                let tableheight = tablecontainer.offsetHeight;\n\n                let data = [];\n                promises[0].done(function (result) {\n                    $.each(result, function (index, value) {\n                        let subject = {};\n                        subject.text = value.subject;\n                        subject.tags = value.tags;\n                        data.push({\n                            'id': value.id,\n                            'subjecttext': value.subject,\n                            'subject': subject,\n                            'contextname': value.contextname,\n                            'lastmodified': value.lastmodified\n                        });\n                    });\n                    this.$table.bootstrapTable({\n                        locale: document.documentElement.lang,\n                        paginationParts: ['pageInfo', 'pageList'],\n                        paginationSuccessivelySize: 2,\n                        paginationPagesBySide: 1,\n                        data: data,\n                        height: tableheight,\n                        columns: [\n                            [{\n                                field: 'state',\n                                checkbox: true\n                            },\n                            {\n                                field: 'subjecttext',\n                                visible: false\n                            },\n                            {\n                                field: 'subject',\n                                title: langStrings[0],\n                                sortable: true,\n                                sortName: 'subjecttext',\n                                width: 300,\n                                formatter: function(value) {\n                                    let nbtags = value.tags.length;\n                                    var td = \"<span class='text-truncate subject'>\" + value.text + \"</span><br>\";\n                                    var nbclass = nbtags === 1 ? 'wcn-1' : 'wcn-2';\n                                    value.tags.forEach(function(item) {\n                                        td += '<span class=\"badge badge-info text-truncate context-note ' + nbclass\n                                            + '\"><a title=\"' + item.title + '\" href=\"' + item.url + '\">'\n                                            + item.title + '</a></span>';\n                                    });\n                                    return td;\n                                }\n                            },\n                            {\n                                field: 'contextname',\n                                title: langStrings[1],\n                                sortable: true\n                            },\n                            {\n                                field: 'lastmodified',\n                                title: langStrings[2],\n                                sortable: true,\n                                formatter: function(value) {\n                                    var today = new Date(value * 1000).toLocaleDateString(document.documentElement.lang, {\n                                        day : 'numeric',\n                                        month : 'short',\n                                        year : 'numeric'\n                                    });\n                                    return today;\n                                },\n                                width: 110,\n                                titleTooltip: langStrings[4]\n                            },\n                            {\n                                field: 'operate',\n                                title: '',\n                                align: 'center',\n                                formatter: function(value, row) {\n                                    return [\n                                        '<a class=\"viewnote\" data-noteid=\"' + row.id + '\" href=\"#\" title=\"' + langStrings[3] + '\">',\n                                        '<i class=\"fa fa-chevron-right\" aria-hidden=\"true\"></i>',\n                                        '</a>'\n                                    ].join('');\n                                }\n                            }]\n                        ],\n                        onPostBody: function() {\n                            displayAddNoteButton();\n                        }\n                    });\n                }).fail(notification.exception);\n            }).fail(Notification.exception);\n        };\n\n        /**\n         * Display add note button.\n         *\n         */\n        var displayAddNoteButton = () => {\n            if (!$(SELECTORS.NOTE_TABLE_CONTAINER).find('.fixed-table-container .addnote').length) {\n                let addnotebtn = $(SELECTORS.ADD_BUTTON_TO_CLONE).clone().removeClass('hidden');\n                window.console.log(addnotebtn);\n                $(SELECTORS.NOTE_TABLE_CONTAINER).find('.fixed-table-container').append(addnotebtn);\n\n                // Add note click event .\n                addnotebtn.on('click', function() {\n                    $(SELECTORS.DRAWER).removeClass('list').addClass('add');\n                    resetNoteForm();\n                    toggleNoteForm('show');\n                });\n            }\n        };\n\n        /**\n         * Close the confirm delete dialogue..\n         *\n         * @param {String} action The action type of cancel.\n         * @param {Boolean} focus\n         */\n        var closeConfirmDialogue = (action, focus) => {\n            $(SELECTORS.DIALOGUE_CONTAINER).addClass('hidden');\n            if (!focus) {\n                return;\n            }\n            if (action === 'multiple') {\n                $(SELECTORS.TABLE_DELETE_BUTTON).focus();\n            } else {\n                $(SELECTORS.DELETE_NOTE_BUTTON).focus();\n            }\n        };\n\n        /**\n         * Show the confirm delete dialogue..\n         *\n         * @param {String} action\n         */\n        var showConfirmDialogue = (action) => {\n            $(SELECTORS.DIALOGUE_CONTAINER).removeClass('hidden');\n            if (action === 'multiple') {\n                let toshow = SELECTORS.CONFIRM_TEXT_MULTI + ', ' + SELECTORS.CONFIRM_DELETE_BUTTON_MULTI + ',' +\n                    SELECTORS.CANCEL_DELETE_BUTTON_MULTI;\n                let tohide = SELECTORS.CONFIRM_TEXT_SINGLE + ', ' + SELECTORS.CONFIRM_DELETE_BUTTON_SINGLE + ',' +\n                    SELECTORS.CANCEL_DELETE_BUTTON_SINGLE;\n                $(tohide).addClass('hidden');\n                $(toshow).removeClass('hidden');\n                let list = [];\n                $(SELECTORS.DRAWER + ' ' + SELECTORS.CHECKBOX_LIST_NOTE + ':checked').each(function(){\n                    list.push($(this).val());\n                });\n                $(SELECTORS.CONFIRM_DELETE_BUTTON_MULTI).data('noteid', list);\n            } else {\n                let tohide = SELECTORS.CONFIRM_TEXT_MULTI + ', ' + SELECTORS.CONFIRM_DELETE_BUTTON_MULTI + ',' +\n                    SELECTORS.CANCEL_DELETE_BUTTON_MULTI;\n                let toshow = SELECTORS.CONFIRM_TEXT_SINGLE + ', ' + SELECTORS.CONFIRM_DELETE_BUTTON_SINGLE + ',' +\n                    SELECTORS.CANCEL_DELETE_BUTTON_SINGLE;\n                $(tohide).addClass('hidden');\n                $(toshow).removeClass('hidden');\n                $(SELECTORS.CONFIRM_DELETE_BUTTON_SINGLE).data('noteid',\n                $(SELECTORS.HEADER_NOTE_DELETE).data('noteid'));\n            }\n        };\n\n        /**\n         * Hide the notebook drawer.\n         *\n         * @param {Object} root The notebook drawer container.\n         */\n        var hide = (root) => {\n            var drawerRoot = getDrawerRoot(root);\n            if (drawerRoot.length) {\n                Drawer.hide(drawerRoot);\n            }\n        };\n\n        /**\n         * Check if the drawer is visible.\n         *\n         * @param {Object} root The notebook drawer container.\n         * @return {boolean}\n         */\n        var isVisible = (root) => {\n            var drawerRoot = getDrawerRoot(root);\n            if (drawerRoot.length) {\n                return Drawer.isVisible(drawerRoot);\n            }\n            return true;\n        };\n\n        /**\n         * Set Jump from button\n         *\n         * @param {String} buttonid The originating button id\n         */\n        var setJumpFrom = (buttonid) => {\n            $(SELECTORS.DRAWER).attr('data-origin', buttonid);\n        };\n\n        /**\n         * Find the root element of the drawer based on the using the drawer content root's ID.\n         *\n         * @param {Object} contentRoot The drawer content's root element.\n         * @returns {*|jQuery}\n         */\n        var getDrawerRoot = (contentRoot) => {\n            contentRoot = $(contentRoot);\n            return contentRoot.closest('[data-region=\"right-hand-notebook-drawer\"]');\n        };\n\n        /**\n         * Submit form ajax.\n         *\n         */\n        var submitFormAjax = () => {\n            if ($(document.activeElement).data('action') == 'reset') {\n                resetNoteForm();\n            } else {\n                let args = {};\n                let update = false;\n                let service = 'local_notebook_add_note';\n                let noteid = $(SELECTORS.NOTE_FORM +' input[name=\"noteid\"]').val();\n                if (noteid !== '0') {\n                    update = true;\n                    service = 'local_notebook_update_note';\n                    args.noteid = noteid;\n                } else {\n                    args.userid = this.userid;\n                    args.courseid = this.courseid;\n                    args.coursemoduleid = this.coursemoduleid;\n                }\n                args.subject = $(SELECTORS.NOTE_FORM +' input[name=\"subject\"]').val();\n                args.note = $(SELECTORS.NOTE_FORM).serialize();\n                ajax.call([{\n                    methodname: service,\n                    args: args,\n                    done: function(result) {\n                        if (result) {\n                            var noteid = args.noteid;\n                            if (!update) {\n                                noteid = result;\n                                delete args.subject;\n                                delete args.note;\n                                delete args.noteid;\n                                ajax.call([{\n                                    methodname: 'local_notebook_get_form_subject',\n                                    args: args,\n                                    done: function(subject) {\n                                        if (subject) {\n                                            // Set new subject.\n                                            $(SELECTORS.NOTE_FORM +' input[name=\"subjectorigin\"]').val(subject);\n                                            // Reset form.\n                                            resetNoteForm();\n                                            // Display success message.\n                                            displayMessageSuccess('notesaved');\n                                            // Refresh list.\n                                            refreshNotes();\n                                        }\n                                    },\n                                    fail: notification.exception\n                                }]);\n                            } else {\n                                // Reset form.\n                                resetNoteForm();\n                                // Display success message.\n                                displayMessageSuccess('notesaved');\n                                // Refresh list.\n                                refreshNotes();\n                            }\n\n                            // Display note.\n                            displayNote(noteid);\n                        }\n                    },\n                    fail: notification.exception\n                }]);\n            }\n            return false;\n        };\n\n        /**\n         * Submit delete ajax.\n         *\n         */\n        var submitDeleteAjax = () => {\n            let action = $(document.activeElement).data('action');\n            let notesids = [];\n            let keymessage = 'notedeleted';\n            if (action === 'confirm-delete-multiple') {\n                notesids = $(document.activeElement).data('noteid');\n                keymessage = 'notedeletedmultiple';\n            } else {\n                notesids.push($(document.activeElement).data('noteid'));\n            }\n            ajax.call([{\n                methodname: 'local_notebook_delete_notes',\n                args: {notes: notesids},\n                done: function(result) {\n                    if (result) {\n                        // Close dialogue.\n                        closeConfirmDialogue('multiple', false);\n                        if (action === 'confirm-delete-single') {\n                            hideNoteView(false);\n                        }\n                        // Display success message.\n                        displayMessageSuccess(keymessage);\n\n                        // Hide note list actions.\n                        if (action === 'confirm-delete-multiple') {\n                            $(SELECTORS.NOTE_LIST_ACTIONS).addClass('hidden');\n                            toggleNoteListFooter('show');\n                        }\n\n                        // Set list mode.\n                        $(SELECTORS.DRAWER).removeClass('view').addClass('list');\n\n                        // Refresh list.\n                        refreshNotes();\n                    }\n                },\n                fail: notification.exception\n            }]);\n            return false;\n        };\n\n        /**\n         * Reset form.\n         *\n         */\n        var resetNoteForm = () => {\n            $(SELECTORS.NOTE_FORM +' input[name=\"subject\"]').val($(SELECTORS.NOTE_FORM +' input[name=\"subjectorigin\"]').val());\n            $(SELECTORS.NOTE_FORM + ' textarea').val('');\n            $(SELECTORS.BODY_CONTAINER+ \" #id_noteeditable\").html('');\n            $(SELECTORS.NOTE_FORM + ' textarea').trigger('change');\n            $(SELECTORS.NOTE_FORM +' input[name=\"noteid\"]').val(0);\n            // Remove message success if exist.\n            $(SELECTORS.MESSAGE_SUCCESS_CONTAINER).html('');\n\n        };\n\n        /**\n         * Hide note view.\n         *\n         * @param {String} focus\n         */\n        var hideNoteView = (focus) => {\n            $(SELECTORS.HEADER_NOTE_VIEW).addClass('hidden');\n            $(SELECTORS.HEADER_NOTE_VIEW).attr('aria-hidden', true);\n            $(SELECTORS.FOOTER_NOTE_VIEW).addClass('hidden');\n            $(SELECTORS.FOOTER_NOTE_VIEW).attr('aria-hidden', true);\n            $(SELECTORS.NOTE_VIEW).addClass('hidden');\n            $(SELECTORS.NOTE_VIEW).attr('aria-hidden', true);\n            $(SELECTORS.BODY_LIST).removeClass('hidden');\n            $(SELECTORS.BODY_LIST).removeAttr('aria-hidden');\n            // Set focus back to last item clicked.\n            if (!focus) {\n                return;\n            }\n            $(focus).focus();\n        };\n\n        /**\n         * Display note view.\n         */\n        var displayNoteView = () => {\n            $(SELECTORS.DRAWER).removeClass('list add edit').addClass('view');\n            $(SELECTORS.HEADER_NOTE_VIEW).removeClass('hidden');\n            $(SELECTORS.HEADER_NOTE_VIEW).removeAttr('aria-hidden');\n            $(SELECTORS.FOOTER_NOTE_VIEW).removeClass('hidden');\n            $(SELECTORS.FOOTER_NOTE_VIEW).removeAttr('aria-hidden');\n            $(SELECTORS.NOTE_VIEW).removeClass('hidden');\n            $(SELECTORS.NOTE_VIEW).removeAttr('aria-hidden');\n            $(SELECTORS.BODY_LIST).addClass('hidden');\n            $(SELECTORS.BODY_LIST).attr('aria-hidden', true);\n        };\n\n        /**\n         * Toggle note form.\n         *\n         * @param {String} action show or hide\n         */\n         var toggleNoteForm = (action) => {\n            if (action === 'show') {\n                $(SELECTORS.NOTE_LIST_CONTAINER).removeClass('h-100');\n                $(SELECTORS.NOTE_TABLE_CONTAINER).addClass('hidden');\n                $(SELECTORS.NOTE_FORM_CONTAINER).removeClass('hidden');\n            } else {\n                $(SELECTORS.NOTE_LIST_CONTAINER).addClass('h-100');\n                $(SELECTORS.NOTE_TABLE_CONTAINER).removeClass('hidden');\n                $(SELECTORS.NOTE_FORM_CONTAINER).addClass('hidden');\n            }\n        };\n\n        /**\n         * Edit note view.\n         *\n         * @param {String} noteid\n         */\n        var editNoteView = (noteid) => {\n            ajax.call([{\n                methodname: 'local_notebook_read_note',\n                args: {noteid: noteid},\n                done: function(result) {\n                    if (result) {\n                        $(SELECTORS.DRAWER).removeClass('view').addClass('edit');\n                        $(SELECTORS.BODY_CONTAINER+ \" #id_noteeditable\").html(result.summary);\n                        $(SELECTORS.NOTE_FORM + ' textarea').val($(SELECTORS.NOTE_VIEW + ' .textareaorigin').val());\n                        $(SELECTORS.NOTE_FORM + ' textarea').trigger('change');\n                        $(SELECTORS.NOTE_FORM +' input[name=\"subject\"]').val(result.subject);\n                        $(SELECTORS.NOTE_FORM +' input[name=\"noteid\"]').val(noteid);\n                        hideNoteView(SELECTORS.NOTE_FORM +' input[name=\"subject\"]');\n                        toggleSaveButton();\n                        toggleNoteForm('show');\n                        $(SELECTORS.DRAWER).removeClass('view').addClass('edit');\n                    }\n                },\n                fail: notification.exception\n            }]);\n        };\n\n        /**\n         * Display message success.\n         *\n         * @param {String} key the string identifier.\n         *\n         */\n        var displayMessageSuccess = (key) => {\n            // Remove old message.\n            $(SELECTORS.MESSAGE_SUCCESS_CONTAINER).html('');\n            var stringkeys = [\n                {\n                    key: key,\n                    component: 'local_notebook'\n                },\n                {\n                    key: 'close',\n                    component: 'core'\n                }\n            ];\n\n            str.get_strings(stringkeys).then(function(langStrings) {\n                let messageHtml = '<div class=\"alert alert-success alert-block fade in \" role=\"alert\">' +\n                '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"' + langStrings[1] + '\">×</button>' +\n                langStrings[0] + '</div>';\n                $(SELECTORS.MESSAGE_SUCCESS_CONTAINER).html(messageHtml);\n                $(SELECTORS.MESSAGE_SUCCESS_CONTAINER + ' .alert button').focus();\n                setTimeout(function() {\n                    $(SELECTORS.MESSAGE_SUCCESS_CONTAINER + ' .alert').fadeOut();\n                }, 10000);\n            });\n        };\n\n        /**\n         * Toggle save button.\n         *\n         */\n        var toggleSaveButton = () => {\n            let editorcontent = $(SELECTORS.BODY_CONTAINER+ \" #id_noteeditable\").html();\n            let emptyeditor = false;\n            let noteid = $(SELECTORS.NOTE_FORM +' input[name=\"noteid\"]').val();\n            let samecontent = false;\n            if (noteid !== '0') {\n                let subjectform = $(SELECTORS.NOTE_FORM + ' input[type=\"text\"]').val();\n                let subjectorigin = $(SELECTORS.DRAWER + ' .titlenote').html();\n                let summaryorigin = $(SELECTORS.DRAWER + ' .summarynote').html();\n                if (subjectform.localeCompare(subjectorigin) === 0 && editorcontent.localeCompare(summaryorigin) === 0) {\n                    samecontent = true;\n                }\n            }\n            if (editorcontent.replace(/<(.|\\n)*?>/g, '').trim().length === 0 && !editorcontent.includes(\"<img\")) {\n                emptyeditor = true;\n            }\n            if ($(SELECTORS.NOTE_FORM + ' input[type=\"text\"]').val() == '' || emptyeditor || samecontent) {\n                $(SELECTORS.NOTE_FORM + ' ' + SELECTORS.SAVE_BUTTON).prop('disabled', true);\n            } else {\n                $(SELECTORS.NOTE_FORM + ' ' + SELECTORS.SAVE_BUTTON).prop('disabled', false);\n            }\n        };\n\n        /**\n         * Toggle note list footer (pagination/ seeAll link).\n         *\n         * @param {String} action show or hide\n         */\n         var toggleNoteListFooter = (action) => {\n            if (action === 'hide') {\n                $(SELECTORS.TABLE_PAGINATION).addClass('invisible');\n                $(SELECTORS.SEEALL_CONTAINER).addClass('invisible');\n            } else {\n                $(SELECTORS.TABLE_PAGINATION).removeClass('invisible');\n                $(SELECTORS.SEEALL_CONTAINER).removeClass('invisible');\n            }\n        };\n\n        /**\n         * Toggle Note list actions.\n         *\n         */\n        var toggleNoteListActions = () => {\n            let selectednotecount = $(SELECTORS.DRAWER + ' ' + SELECTORS.CHECKBOX_LIST_NOTE + ':checked').length;\n\n            if (selectednotecount) {\n                let arialabel = selectednotecount + ' ' + $(SELECTORS.SELECTED_NOTE_COUNT).attr('data-arialabel');\n                $(SELECTORS.MESSAGE_SUCCESS_CONTAINER).empty();\n                $(SELECTORS.SELECTED_NOTE_COUNT).text(selectednotecount);\n                $(SELECTORS.SELECTED_NOTE_COUNT).attr('aria-label', arialabel);\n                toggleNoteListFooter('hide');\n                $(SELECTORS.NOTE_LIST_ACTIONS).removeClass('hidden');\n            } else {\n                toggleNoteListFooter('show');\n                $(SELECTORS.NOTE_LIST_ACTIONS).addClass('hidden');\n            }\n        };\n\n        /**\n         * Listen to showing and hiding the notebook drawer.\n         *\n         * @param {Object} root The notebook drawer container.\n         * @param {String} userid The user ID\n         * @param {String} courseid The course ID\n         * @param {String} coursemoduleid The cours module ID\n         */\n        var registerEventListeners = (root, userid, courseid, coursemoduleid) => {\n            this.userid = userid;\n            this.courseid = courseid;\n            this.coursemoduleid = coursemoduleid;\n            this.$table = $(SELECTORS.NOTE_TABLE);\n            $(SELECTORS.DRAWER).on('click', SELECTORS.REFRESH_BUTTON, function () {\n                refreshNotes();\n            });\n            CustomEvents.define(root, [CustomEvents.events.activate]);\n            PubSub.subscribe(Events.SHOW, function () {\n                show(root);\n            });\n\n            PubSub.subscribe(Events.HIDE, function () {\n                hide(root);\n            });\n\n            PubSub.subscribe(Events.TOGGLE_VISIBILITY, function (buttonid) {\n                if (isVisible(root)) {\n                    hide(root);\n                    $(SELECTORS.JUMPTO).attr('tabindex', -1);\n                    // Load formchangechecker module.\n                    Y.use('moodle-core-formchangechecker', function() {\n                        M.core_formchangechecker.init({formid: SELECTORS.NOTE_FORM_ID});\n                    });\n                    Y.use('moodle-core-formchangechecker', function() {\n                        M.core_formchangechecker.reset_form_dirty_state();\n                    });\n                } else {\n                    show(root);\n                    setJumpFrom(buttonid);\n                    $(SELECTORS.JUMPTO).attr('tabindex', 0);\n                }\n            });\n\n            $(SELECTORS.JUMPTO).on('focus', function() {\n                var firstInput = root.find(SELECTORS.CLOSE_BUTTON);\n                if (firstInput.length) {\n                    firstInput.focus();\n                } else {\n                    $(SELECTORS.HEADER_CONTAINER).find(SELECTORS.ROUTES_BACK).focus();\n                }\n            });\n\n            $(SELECTORS.DRAWER).focus(function() {\n                var button = $(this).attr('data-origin');\n                if (button) {\n                    $('#' + button).focus();\n                }\n            });\n\n            var closebutton = root.find(SELECTORS.CLOSE_BUTTON);\n            closebutton.on(CustomEvents.events.activate, function(e, data) {\n                data.originalEvent.preventDefault();\n                var button = $(SELECTORS.DRAWER).attr('data-origin');\n                if (button) {\n                    $('#' + button).focus();\n                }\n                PubSub.publish(Events.TOGGLE_VISIBILITY);\n            });\n\n            // Back to list.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.BACK_TO_LIST, function() {\n                hideNoteView(SELECTORS.VIEW_NOTE + '[data-noteid=\"' + $(this).data('noteid') + '\"]');\n                toggleNoteForm('hide');\n                $(SELECTORS.DRAWER).removeClass('view').addClass('list');\n            });\n\n            // Note table row click event.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.NOTE_TABLE_ROW + ' td:not(:first-child)', function(e) {\n                if (!$(e.target).hasClass('context-note') &&\n                    !$(e.target).parent().hasClass('context-note')) {\n                    let noteid = $(this).closest('tr').find('.viewnote').data('noteid');\n                    displayNote(noteid);\n                }\n            });\n            // Note table row checkbox cell click event.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.NOTE_TABLE_ROW + ' td:first-child', function(e) {\n                if($(this).find('.card-views').length) { // card view mode.\n                    if (!$(e.target).is('label, input') &&\n                        !$(e.target).hasClass('context-note') &&\n                        !$(e.target).parent().hasClass('context-note')) {\n                        let noteid = $(this).closest('tr').find('.viewnote').data('noteid');\n                        displayNote(noteid);\n                    }\n                } else {\n                    $(this).find('input[type=\"checkbox\"]').trigger('click');\n                }\n            });\n            // Edit note.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.HEADER_NOTE_EDIT, function() {\n                editNoteView($(this).data('noteid'));\n            });\n            // Cancel add/dit note.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.CANCEL_BUTTON, function(e) {\n                e.preventDefault();\n                if($(SELECTORS.DRAWER).hasClass('edit')) {\n                    let noteid = $(SELECTORS.HEADER_NOTE_EDIT).data('noteid');\n                    displayNote(noteid);\n                } else {\n                    toggleNoteForm('hide');\n                    $(SELECTORS.DRAWER).removeClass('add').addClass('list');\n                }\n            });\n            // Cancel delete note.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.CANCEL_DELETE_BUTTON_SINGLE, function() {\n                closeConfirmDialogue('single', true);\n            });\n            $(SELECTORS.DRAWER).on('click', SELECTORS.CANCEL_DELETE_BUTTON_MULTI, function() {\n                closeConfirmDialogue('multiple', true);\n            });\n            // Delete note button.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.DELETE_NOTE_BUTTON, function() {\n                let action = 'multiple';\n                if ($(this).data('noteid')) {\n                    action = 'single';\n                }\n                showConfirmDialogue(action);\n            });\n            // Confirm delete note button.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.CONFIRM_DELETE_BUTTON_SINGLE + ' , ' + SELECTORS.CONFIRM_DELETE_BUTTON_MULTI,\n                            submitDeleteAjax);\n            // If notebook drawer is visible and we open message drawer, hide notebook.\n            var msdrawerRoot = Drawer.getDrawerRoot($('[data-region=\"message-drawer\"]'));\n            var messagetoggler = $('[id^=\"message-drawer-toggle-\"]');\n            messagetoggler.on('click keydown keypress', function() {\n                var keycode = (event.keyCode ? event.keyCode : event.which);\n                // Enter, space or click.\n                if (keycode == '13' || keycode == '32' || event.type == 'click') {\n                    if (Drawer.isVisible(msdrawerRoot) && isVisible(root)) {\n                        hide(root);\n                    }\n                }\n            });\n\n            $(SELECTORS.BODY_CONTAINER).on('submit', 'form', submitFormAjax);\n\n            // Enable/disbled save button.\n            toggleSaveButton();\n            $(SELECTORS.BODY_CONTAINER + ' form input[type=\"text\"]').on('input', toggleSaveButton);\n            $(SELECTORS.BODY_CONTAINER + ' form textarea').on('change', toggleSaveButton);\n            // Enable/disbled delete button.\n            $(SELECTORS.DRAWER).on('change', SELECTORS.CHECKBOX_LIST_NOTE + ', ' + SELECTORS.CHECKBOX_ALL_NOTE,\n                            toggleNoteListActions);\n\n            // Close note list actions.\n            $(SELECTORS.DRAWER).on('click', SELECTORS.CLOSE_NOTE_LIST_ACTIONS, function() {\n                $(SELECTORS.CHECKBOX_ALL_NOTE).prop('checked', false).trigger('click');\n                toggleNoteListFooter('show');\n            });\n        };\n\n        /**\n         * Initialise the notebook drawer.\n         *\n         * @param {Object} root The notebook drawer container.\n         * @param {String} userid The user ID\n         * @param {String} courseid The course ID\n         * @param {String} coursemoduleid The cours module ID\n         */\n        var init = (root, userid, courseid, coursemoduleid) => {\n            root = $(root);\n            registerEventListeners(root, userid, courseid, coursemoduleid);\n        };\n\n        return {\n            init: init,\n        };\n    });\n"],"file":"notebook_drawer.min.js"}